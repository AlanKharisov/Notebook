<!doctype html>
<html lang="uk" id="html-lang">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="page-title">Кулінарна книга</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <!-- Иконки -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #35da0d;
        --secondary: #1c6204;
        --primary-light: #57b833;
        --accent: #49b028;
        --text: #0f172a;
        --muted: #64748b;
        --bg: #f8fafc;
        --card: #ffffff;
        --border: #e5e7eb;
        --shadow: 0 8px 22px rgba(2, 6, 23, 0.06);
        --radius: 14px;
        --transition: all 0.22s ease;

        /* Настройки размеров */
        --base-font-size: 18px;
        --h1-size: 1.55rem;
        --h2-size: 1.25rem;
        --h3-size: 1.1rem;
        --p-size: 1rem;
        --small-size: 0.92rem;
        --button-font-size: 1rem;
        --button-padding: 0.58rem 0.9rem;
      }

      /* =========================================
   ===== BOOK COVER (NEW: REAL BOOK LOOK) ===
   ========================================= */

      .book-container {
        position: fixed;
        inset: 0;
        background: radial-gradient(
          1200px 700px at 50% 40%,
          #242446 0%,
          #121225 55%,
          #0b0b15 100%
        );
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        perspective: 2400px;
        overflow: hidden;
      }

      /* Сцена книги */
      .book {
        /* почти на весь экран, но с безопасными отступами */
        width: min(96vw, 1200px);
        height: min(88vh, 780px);

        position: relative;
        transform-style: preserve-3d;
        transform-origin: left center;

        /* чуть повернём как в рефе */
        transform: rotateX(4deg) rotateY(-10deg);
      }

      /* ====== ЛИСТ (страница) ====== */
      .book__pages {
        position: absolute;
        inset: 0;
        border-radius: 18px;

        /* лист всегда перед камерой */
        transform: translateZ(2px);
        backface-visibility: hidden;
        z-index: 2;

        background: linear-gradient(180deg, #ffffff 0%, #f3f4f6 100%);
        box-shadow:
          0 28px 70px rgba(0, 0, 0, 0.45),
          inset 0 0 0 1px rgba(0, 0, 0, 0.06);
        overflow: hidden;
      }

      /* имитация "стопки страниц" справа (как на рефе) */
      .book__pages::after {
        content: "";
        position: absolute;
        top: 14px;
        bottom: 14px;
        right: -26px;
        width: 70px;
        border-radius: 16px;

        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.9) 35%,
          rgba(235, 236, 240, 1) 70%,
          rgba(210, 212, 218, 1) 100%
        );

        box-shadow:
          -18px 0 40px rgba(0, 0, 0, 0.1),
          inset 12px 0 18px rgba(0, 0, 0, 0.06);

        transform: translateZ(-1px) rotateZ(-2deg);
        pointer-events: none;
        opacity: 0.95;
      }

      /* лёгкая тень/корешок слева внутри листа */
      .book__pages::before {
        content: "";
        position: absolute;
        left: 0;
        top: 10px;
        bottom: 10px;
        width: 52px;
        border-radius: 18px 0 0 18px;

        background: linear-gradient(
          90deg,
          rgba(0, 0, 0, 0.26) 0%,
          rgba(0, 0, 0, 0.1) 40%,
          rgba(0, 0, 0, 0) 100%
        );
        pointer-events: none;
        opacity: 0.55;
      }

      /* ====== ОБЛОЖКА (дверца) ====== */
      .book__cover {
        position: absolute;
        inset: 0;
        border-radius: 18px;

        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;

        /* коричневая обложка */
        background: linear-gradient(
          135deg,
          #5a3a22 0%,
          #7b4a2a 45%,
          #3b2416 100%
        );
        box-shadow:
          0 40px 90px rgba(0, 0, 0, 0.6),
          inset 0 0 0 2px rgba(255, 255, 255, 0.07),
          inset 0 0 90px rgba(255, 255, 255, 0.06);

        transform-style: preserve-3d;
        transform-origin: left center;

        /* ВАЖНО: обложка лежит ПЛОТНО на листе (без щели) */
        transform: translateZ(6px) rotateY(0deg);
        backface-visibility: hidden;
        z-index: 5;

        transition: transform 1.15s cubic-bezier(0.2, 0.9, 0.18, 1);
      }

      /* внутренняя сторона обложки */
      .book__cover::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 18px;
        background: linear-gradient(
          135deg,
          #f7f0e2 0%,
          #efe3cf 55%,
          #e9dbc2 100%
        );
        transform: rotateY(180deg) translateZ(1px);
        backface-visibility: hidden;

        box-shadow: inset 0 0 60px rgba(0, 0, 0, 0.1);
      }

      /* ====== КОРЕШОК (снаружи слева) ====== */
      .book__spine {
        position: absolute;
        left: -26px;
        top: 18px;
        bottom: 18px;
        width: 44px;

        border-radius: 16px;
        background: linear-gradient(
          180deg,
          #2b1a10 0%,
          #3b2416 40%,
          #1f120b 100%
        );

        transform: translateZ(4px);
        box-shadow:
          inset -10px 0 18px rgba(0, 0, 0, 0.45),
          10px 0 28px rgba(0, 0, 0, 0.35);
      }

      /* ====== ОТКРЫТИЕ ======
   - убираем "вылазит внутрь" и "щель"
   - в открытом состоянии даём небольшое смещение, чтобы выглядело как реф */
      .book.open .book__cover {
        transform: translateZ(6px) rotateY(-165deg);
      }

      .book.open .book__pages {
        box-shadow:
          0 35px 90px rgba(0, 0, 0, 0.55),
          inset 0 0 0 1px rgba(0, 0, 0, 0.06);
      }

      /* Контент на странице (лоадер по центру) */
      .book__page-content {
        padding: clamp(18px, 4vw, 46px);
        text-align: center;
        width: 100%;
        height: 100%;

        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;

        background: transparent;
      }

      /* Заголовки на обложке — чуть компактнее, чтобы влезали на всех экранах */
      .book__title {
        font-size: clamp(2.1rem, 6vw, 5rem);
        font-weight: 900;
        color: #fff;
        text-shadow:
          0 10px 22px rgba(0, 0, 0, 0.55),
          0 0 55px rgba(255, 255, 255, 0.18);
        margin: 0;
        letter-spacing: 3px;
        text-align: center;
        padding: 0 18px;
        font-family: "Georgia", "Times New Roman", serif;
      }

      .book__title::after {
        content: "";
        display: block;
        margin: 18px auto 0;
        width: min(260px, 60%);
        height: 4px;
        border-radius: 999px;
        background: linear-gradient(
          90deg,
          transparent,
          #d6b15c,
          #ffd27a,
          transparent
        );
        box-shadow: 0 0 18px rgba(255, 210, 122, 0.55);
      }

      .book__subtitle {
        font-size: clamp(1rem, 2.5vw, 1.8rem);
        color: rgba(255, 255, 255, 0.86);
        font-weight: 350;
        margin-top: 2.1rem;
        font-style: italic;
        text-align: center;
        max-width: 85%;
      }

      /* орнамент */
      .book__ornament {
        position: absolute;
        top: 22px;
        right: 22px;
        width: 64px;
        height: 64px;
        background: radial-gradient(
          circle,
          #ffd27a 0%,
          #d6b15c 70%,
          #b48a35 100%
        );
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow:
          0 0 26px rgba(255, 210, 122, 0.55),
          inset 0 0 18px rgba(255, 255, 255, 0.25);
        opacity: 0.95;
      }

      .book__ornament i {
        font-size: 1.8rem;
        color: #4a2b14;
      }

      /* loader */
      .book__loader {
        width: 82px;
        height: 82px;
        position: relative;
        margin-bottom: 1.4rem;
      }

      .book__loader-circle {
        position: absolute;
        width: 100%;
        height: 100%;
        border: 4px solid transparent;
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 1.5s linear infinite;
      }

      .book__loader-circle:nth-child(2) {
        border-top-color: var(--secondary);
        animation-delay: 0.2s;
        width: 72%;
        height: 72%;
        top: 14%;
        left: 14%;
      }

      .book__loader-circle:nth-child(3) {
        border-top-color: var(--accent);
        animation-delay: 0.4s;
        width: 58%;
        height: 58%;
        top: 21%;
        left: 21%;
      }

      .book__loading-text {
        font-size: clamp(1.2rem, 3vw, 1.8rem);
        color: #7b4a2a;
        font-weight: 900;
        margin-top: 0.4rem;
      }

      .book__loading-subtext {
        font-size: clamp(0.9rem, 2.2vw, 1.2rem);
        color: rgba(15, 23, 42, 0.55);
        margin-top: 0.35rem;
        font-style: italic;
      }

      /* контейнер скрытия */
      .book-container.hidden {
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.8s ease;
      }

      /* Анимации */
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Мобилка: ещё больше экрана */
      @media (max-width: 780px) {
        .book {
          width: 96vw;
          height: 86vh;
          transform: rotateX(3deg) rotateY(-8deg);
        }
        .book__spine {
          left: -22px;
          width: 38px;
        }
      }

      /* ===== MAIN CONTENT ===== */
      .main-content {
        display: none;
        opacity: 0;
        transition: opacity 0.8s ease;
      }

      .main-content.visible {
        display: block;
        opacity: 1;
      }

      /* Постельные темы - теперь заменяют основной зеленый цвет */
      body.theme-default {
        --primary: #35da0d;
        --secondary: #1c6204;
        --primary-light: #57b833;
        --accent: #49b028;
      }

      body.theme-soft {
        --bg-theme: #fef6ff;
        --card-theme: #ffffff;
        --border-theme: #f3e8ff;
        --shadow: 0 8px 22px rgba(168, 85, 247, 0.06);
        --primary: #c084fc;
        --secondary: #9333ea;
        --primary-light: #d8b4fe;
        --accent: #a855f7;
      }

      body.theme-warm {
        --bg-theme: #fff7ed;
        --card-theme: #ffffff;
        --border-theme: #fed7aa;
        --shadow: 0 8px 22px rgba(249, 115, 22, 0.06);
        --primary: #fb923c;
        --secondary: #ea580c;
        --primary-light: #fdba74;
        --accent: #f97316;
      }

      body.theme-cool {
        --bg-theme: #f0f9ff;
        --card-theme: #ffffff;
        --border-theme: #bae6fd;
        --shadow: 0 8px 22px rgba(14, 165, 233, 0.06);
        --primary: #38bdf8;
        --secondary: #0284c7;
        --primary-light: #7dd3fc;
        --accent: #0ea5e9;
      }

      body.theme-rose {
        --bg-theme: #fff1f2;
        --card-theme: #ffffff;
        --border-theme: #fecdd3;
        --shadow: 0 8px 22px rgba(244, 63, 94, 0.06);
        --primary: #fb7185;
        --secondary: #e11d48;
        --primary-light: #fda4af;
        --accent: #f43f5e;
      }

      body.theme-mint {
        --bg-theme: #f0fdf4;
        --card-theme: #ffffff;
        --border-theme: #bbf7d0;
        --shadow: 0 8px 22px rgba(34, 197, 94, 0.06);
        --primary: #4ade80;
        --secondary: #16a34a;
        --primary-light: #86efac;
        --accent: #22c55e;
      }

      html {
        font-size: var(--base-font-size);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg-theme);
        color: var(--text);
        line-height: 1.65;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        transition:
          background-color 0.3s ease,
          --primary 0.3s ease,
          --secondary 0.3s ease;
      }

      /* ===== Header ===== */
      .header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: var(--primary);
        box-shadow: var(--shadow);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .header__row {
        max-width: 980px;
        margin: 0 auto;
        padding: 0.85rem 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .header__left,
      .header__right {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        flex: 0 0 auto;
      }

      .header__title {
        flex: 1;
        text-align: center;
        margin: 0;
        font-size: var(--h1-size);
        font-weight: 900;
        color: #fff;
        letter-spacing: 0.2px;
        user-select: none;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .btn {
        appearance: none;
        border: 1px solid rgba(255, 255, 255, 0.22);
        background: rgba(255, 255, 255, 0.14);
        color: #fff;
        padding: var(--button-padding);
        border-radius: 999px;
        font-weight: 800;
        font-size: var(--button-font-size);
        cursor: pointer;
        transition: var(--transition);
        backdrop-filter: saturate(120%) blur(2px);
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        white-space: nowrap;
      }

      .btn:hover {
        background: rgba(255, 255, 255, 0.22);
        transform: translateY(-1px);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:focus-visible {
        outline: 3px solid rgba(73, 176, 40, 0.35);
        outline-offset: 2px;
      }

      .btn.auth-btn {
        display: none; /* Скрыта по умолчанию */
        animation: fadeIn 0.5s ease;
      }

      /* ===== Search bar ===== */
      .search-wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 0 1rem 1rem;
      }

      .search {
        display: flex;
        gap: 0.6rem;
        background: rgba(255, 255, 255, 0.18);
        border: 1px solid rgba(255, 255, 255, 0.22);
        border-radius: 999px;
        padding: 0.5rem 0.55rem;
        box-shadow: 0 10px 22px rgba(2, 6, 23, 0.08);
      }

      .search__input {
        width: 100%;
        border: none;
        outline: none;
        background: transparent;
        color: #fff;
        font-size: var(--p-size);
        font-weight: 650;
        padding: 0.25rem 0.4rem;
      }

      .search__input::placeholder {
        color: rgba(255, 255, 255, 0.85);
        font-weight: 650;
      }

      .search__chip {
        border: 1px solid rgba(255, 255, 255, 0.24);
        background: rgba(255, 255, 255, 0.14);
        color: #fff;
        border-radius: 999px;
        padding: 0.42rem 0.7rem;
        font-weight: 800;
        font-size: var(--small-size);
        cursor: pointer;
        transition: var(--transition);
        white-space: nowrap;
      }

      .search__chip:hover {
        background: rgba(255, 255, 255, 0.22);
        transform: translateY(-1px);
      }

      /* ===== Layout ===== */
      .main {
        max-width: 980px;
        margin: 0 auto;
        padding: 1rem;
        padding-bottom: 2rem;
      }

      .screen {
        display: none;
      }

      .screen.is-active {
        display: block;
      }

      .section-title {
        margin: 0.35rem 0 1rem;
        font-size: var(--h2-size);
        font-weight: 900;
        color: var(--secondary);
      }

      /* ===== Cards ===== */
      .card {
        background: var(--card-theme);
        border: 1px solid var(--border-theme);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      /* ===== Categories ===== */
      .category {
        margin-bottom: 1rem;
        transition: var(--transition);
      }

      .category:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 26px rgba(2, 6, 23, 0.09);
      }

      .category__head {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.85rem 1rem;
        background: var(--secondary);
        color: #fff;
      }

      .category__toggle {
        flex: 1;
        border: none;
        background: none;
        color: inherit;
        text-align: left;
        font-size: var(--p-size);
        font-weight: 900;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .category__meta {
        font-size: var(--small-size);
        opacity: 0.95;
        font-weight: 750;
        white-space: nowrap;
      }

      .category__actions {
        display: flex;
        gap: 0.55rem;
        flex: 0 0 auto;
      }

      .icon-btn {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: rgba(255, 255, 255, 0.12);
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        color: #fff;
        font-size: var(--small-size);
      }

      .icon-btn:hover {
        background: rgba(255, 255, 255, 0.22);
        transform: translateY(-1px);
      }

      .icon-btn:active {
        transform: translateY(0);
      }

      .category__body {
        padding: 0.9rem 1rem 1rem;
      }

      .add-dish-btn-container {
        margin-bottom: 0.6rem;
        display: none;
      }

      .add-dish-btn-container.visible {
        display: block;
      }

      .btn-long {
        appearance: none;
        border: none;
        background: linear-gradient(135deg, var(--secondary), var(--accent));
        color: #fff;
        padding: 0.85rem 1rem;
        border-radius: 12px;
        font-weight: 900;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: 0 10px 22px rgba(73, 176, 40, 0.18);
        white-space: nowrap;
        width: 100%;
        text-align: center;
        font-size: var(--button-font-size);
      }

      .btn-long:hover {
        transform: translateY(-1px);
        box-shadow: 0 14px 26px rgba(73, 176, 40, 0.24);
      }

      .btn-long:active {
        transform: translateY(0);
      }

      .dishes {
        display: none;
      }

      .dishes.is-open {
        display: block;
      }

      .dish {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.7rem;
        padding: 0.85rem 0.2rem;
        border-bottom: 1px solid var(--border-theme);
        transition: var(--transition);
        border-radius: 10px;
      }

      .dish:last-child {
        border-bottom: none;
      }

      .dish:hover {
        background: rgba(73, 176, 40, 0.05);
      }

      .dish__main {
        flex: 1;
        min-width: 0;
      }

      .dish__title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: var(--p-size);
        font-weight: 900;
        margin: 0;
        color: var(--text);
        cursor: pointer;
        user-select: none;
      }

      .dish__title:hover {
        color: var(--primary);
      }

      .dish__sub {
        margin: 0.12rem 0 0;
        color: var(--muted);
        font-size: var(--small-size);
        font-weight: 650;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.2rem 0.55rem;
        border-radius: 999px;
        border: 1px solid var(--border-theme);
        background: var(--bg-theme);
        color: var(--text);
        font-size: 0.85rem;
        font-weight: 800;
        white-space: nowrap;
      }

      .tag.star {
        background: #fff7ed;
        border-color: #fed7aa;
      }

      .dish__actions {
        display: flex;
        gap: 0.5rem;
        flex: 0 0 auto;
      }

      .icon-mini {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        border: 1px solid var(--border-theme);
        background: var(--card-theme);
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: var(--text);
        font-weight: 900;
        font-size: var(--small-size);
      }

      .icon-mini:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 18px rgba(2, 6, 23, 0.08);
      }

      .icon-mini:active {
        transform: translateY(0);
      }

      /* ===== Sub-dishes ===== */
      .subdish-container {
        margin-left: 1.5rem;
        margin-top: 0.5rem;
        border-left: 2px solid var(--primary-light);
        padding-left: 1rem;
      }

      .subdish {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.7rem;
        padding: 0.6rem 0.2rem;
        border-bottom: 1px dashed var(--border-theme);
        transition: var(--transition);
      }

      .subdish:last-child {
        border-bottom: none;
      }

      .subdish:hover {
        background: rgba(73, 176, 40, 0.03);
      }

      .subdish__title {
        flex: 1;
        font-size: var(--small-size);
        font-weight: 700;
        margin: 0;
        color: var(--text);
        cursor: pointer;
      }

      .subdish__title:hover {
        color: var(--primary);
      }

      .subdish__actions {
        display: flex;
        gap: 0.4rem;
        flex: 0 0 auto;
      }

      .icon-micro {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: 1px solid var(--border-theme);
        background: var(--card-theme);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: var(--text);
        font-size: 0.8rem;
        transition: var(--transition);
      }

      .icon-micro:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 12px rgba(2, 6, 23, 0.06);
      }

      .add-subdish-btn {
        margin-top: 0.5rem;
        background: rgba(73, 176, 40, 0.1);
        border: 1px dashed var(--primary-light);
        color: var(--primary);
        padding: 0.4rem 0.8rem;
        border-radius: 8px;
        font-weight: 700;
        font-size: 0.85rem;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
      }

      .add-subdish-btn:hover {
        background: rgba(73, 176, 40, 0.15);
        transform: translateY(-1px);
      }

      /* ===== Search Results ===== */
      .search-results {
        display: grid;
        gap: 0.9rem;
      }

      .result {
        padding: 0.9rem 1rem;
        border-radius: var(--radius);
        border: 1px solid var(--border-theme);
        background: var(--card-theme);
        box-shadow: var(--shadow);
        transition: var(--transition);
      }

      .result:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 26px rgba(2, 6, 23, 0.09);
      }

      .result__top {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 0.75rem;
      }

      .result__title {
        margin: 0;
        font-size: 1.05rem;
        font-weight: 950;
        color: var(--text);
      }

      .result__type {
        font-size: 0.85rem;
        font-weight: 900;
        color: var(--secondary);
        background: #ecfccb;
        border: 1px solid #d9f99d;
        padding: 0.18rem 0.5rem;
        border-radius: 999px;
        white-space: nowrap;
      }

      .result__desc {
        margin: 0.35rem 0 0;
        color: var(--muted);
        font-size: 0.95rem;
        font-weight: 650;
      }

      .result__actions {
        margin-top: 0.65rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
      }

      .btn-outline {
        appearance: none;
        border: 2px solid var(--primary);
        background: transparent;
        color: var(--primary);
        padding: 0.55rem 0.9rem;
        border-radius: 999px;
        font-weight: 900;
        cursor: pointer;
        transition: var(--transition);
        font-size: var(--button-font-size);
      }

      .btn-outline:hover {
        background: var(--primary);
        color: #fff;
        transform: translateY(-1px);
      }

      .btn-outline:active {
        transform: translateY(0);
      }

      /* ===== Recipe View ===== */
      .back-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-bottom: 0.9rem;
      }

      .btn-back {
        appearance: none;
        border: 2px solid var(--primary);
        background: transparent;
        color: var(--primary);
        padding: 0.55rem 0.9rem;
        border-radius: 999px;
        font-weight: 950;
        cursor: pointer;
        transition: var(--transition);
        font-size: var(--button-font-size);
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        white-space: nowrap;
      }

      .btn-back:hover {
        background: var(--primary);
        color: #fff;
        transform: translateY(-1px);
      }

      .recipe {
        padding: 1rem;
      }

      .recipe__title {
        margin: 0;
        font-size: 1.2rem;
        font-weight: 950;
        color: var(--secondary);
        display: flex;
        align-items: center;
        gap: 0.6rem;
        flex-wrap: wrap;
      }

      .recipe__content {
        margin-top: 0.8rem;
        padding: 0.9rem;
        border: 1px solid var(--border-theme);
        border-radius: var(--radius);
        background: var(--card-theme);
        font-size: var(--p-size);
        line-height: 1.85;
        white-space: pre-wrap;
        word-break: break-word;
        overflow-wrap: anywhere;
      }

      .recipe__content.edit-mode {
        background: #f6fdf4;
        border: 2px solid var(--primary-light);
        padding: 1.1rem;
        min-height: 280px;
        border-radius: var(--radius);
        outline: none;
        cursor: text;
      }

      .recipe__tools {
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
        margin-top: 0.9rem;
      }

      .btn-wide {
        appearance: none;
        border: none;
        background: var(--primary);
        color: #fff;
        padding: 0.85rem 1rem;
        border-radius: 12px;
        font-weight: 950;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--shadow);
        flex: 1 1 220px;
        text-align: center;
        font-size: var(--button-font-size);
      }

      .btn-wide:hover {
        background: var(--primary-light);
        transform: translateY(-1px);
      }

      /* Video block */
      .video {
        margin-top: 1rem;
        padding: 0.9rem;
        border: 1px solid var(--border-theme);
        border-radius: var(--radius);
        background: #f6fdf4;
      }

      .video__top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-bottom: 0.6rem;
      }

      .video__title {
        margin: 0;
        font-size: var(--p-size);
        font-weight: 950;
        color: var(--secondary);
      }

      .video__link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
        color: var(--text);
        font-weight: 800;
        font-size: var(--small-size);
      }

      .video__link a {
        color: var(--secondary);
        text-decoration: none;
        font-weight: 950;
        border-bottom: 1px dashed rgba(28, 98, 4, 0.45);
      }

      .video__link a:hover {
        border-bottom-style: solid;
      }

      .video__frame {
        margin-top: 0.75rem;
        border-radius: 14px;
        overflow: hidden;
        border: 1px solid rgba(73, 176, 40, 0.25);
        background: #000;
        aspect-ratio: 16 / 9;
      }

      .video__frame iframe {
        width: 100%;
        height: 100%;
        border: 0;
        display: block;
      }

      .video__note {
        margin-top: 0.55rem;
        color: var(--muted);
        font-size: var(--small-size);
        font-weight: 650;
      }

      /* Social Links block */
      .social-links {
        margin-top: 1rem;
        padding: 0.9rem;
        border: 1px solid var(--border-theme);
        border-radius: var(--radius);
        background: #f6fdf4;
      }

      .social-links__top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-bottom: 0.6rem;
      }

      .social-links__title {
        margin: 0;
        font-size: var(--p-size);
        font-weight: 950;
        color: var(--secondary);
      }

      .social-links__list {
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
      }

      .social-link-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.7rem;
        background: var(--card-theme);
        border-radius: var(--radius);
        border: 1px solid var(--border-theme);
      }

      .social-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
      }

      .social-icon.youtube {
        background: #ff0000;
      }
      .social-icon.tiktok {
        background: #000000;
      }
      .social-icon.facebook {
        background: #1877f2;
      }
      .social-icon.instagram {
        background: linear-gradient(
          45deg,
          #405de6,
          #5851db,
          #833ab4,
          #c13584,
          #e1306c,
          #fd1d1d
        );
      }
      .social-icon.twitter {
        background: #1da1f2;
      }
      .social-icon.other {
        background: var(--primary);
      }

      .social-link-content {
        flex: 1;
        min-width: 0;
      }

      .social-link-name {
        margin: 0;
        font-weight: 700;
        color: var(--text);
        font-size: var(--p-size);
      }

      .social-link-url {
        margin: 0.2rem 0 0;
        color: var(--muted);
        font-size: var(--small-size);
        word-break: break-all;
      }

      .social-link-actions {
        display: flex;
        gap: 0.4rem;
      }

      .social-action-btn {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        border: 1px solid var(--border-theme);
        background: var(--card-theme);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: var(--text);
        transition: var(--transition);
      }

      .social-action-btn:hover {
        background: #f1fbf3;
        transform: translateY(-1px);
      }

      /* Empty / helper */
      .empty {
        padding: 1rem;
        border: 1px dashed var(--border-theme);
        border-radius: var(--radius);
        background: var(--card-theme);
        color: var(--muted);
        font-weight: 700;
        font-size: var(--p-size);
      }

      /* ===== Settings Sidebar ===== */
      .settings-btn {
        position: fixed;
        left: 1rem;
        bottom: 1rem;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        color: white;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 99;
        box-shadow: var(--shadow);
        transition: var(--transition);
      }

      .settings-btn:hover {
        transform: scale(1.1);
      }

      .settings-sidebar {
        position: fixed;
        left: -320px;
        top: 0;
        width: 300px;
        height: 100%;
        background: var(--card-theme);
        box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
        z-index: 100;
        transition: left 0.3s ease;
        padding: 1.5rem;
        overflow-y: auto;
      }

      .settings-sidebar.open {
        left: 0;
      }

      .settings-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
        display: none;
      }

      .settings-overlay.open {
        display: block;
      }

      .settings-title {
        margin-top: 0;
        color: var(--secondary);
        font-size: var(--h2-size);
      }

      .settings-section {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border-theme);
      }

      .settings-section-title {
        font-size: var(--h3-size);
        color: var(--text);
        margin: 0 0 0.8rem 0;
      }

      .theme-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.6rem;
        margin-bottom: 1rem;
      }

      .theme-option {
        aspect-ratio: 1.5;
        border-radius: 8px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--text);
        font-size: 0.7rem;
        font-weight: 600;
        padding: 0.5rem;
      }

      .theme-option:hover {
        transform: translateY(-2px);
      }

      .theme-option.selected {
        border-color: var(--primary);
        transform: translateY(-2px);
      }

      .toggle-switch {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
        padding: 0.5rem 0;
      }

      .toggle-label {
        font-weight: 600;
        color: var(--text);
        font-size: var(--small-size);
      }

      .toggle-input {
        position: relative;
        width: 50px;
        height: 26px;
      }

      .toggle-input input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      .toggle-input input:checked + .toggle-slider {
        background-color: var(--primary);
      }

      .toggle-input input:checked + .toggle-slider:before {
        transform: translateX(24px);
      }

      .size-control {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.8rem;
      }

      .size-label {
        flex: 1;
        font-weight: 600;
        color: var(--text);
        font-size: var(--small-size);
      }

      .size-value {
        width: 40px;
        text-align: center;
        font-weight: 700;
        color: var(--secondary);
      }

      .size-slider {
        flex: 2;
        -webkit-appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: var(--border-theme);
        outline: none;
      }

      .size-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--primary);
        cursor: pointer;
      }

      .language-selector {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .lang-btn {
        padding: 0.6rem 0.4rem;
        border: 1px solid var(--border-theme);
        background: var(--card-theme);
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        text-align: center;
      }

      .lang-btn:hover {
        background: rgba(73, 176, 40, 0.1);
      }

      .lang-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      /* Google Login Button */
      .google-btn {
        background: #fff;
        color: #757575;
        border: 1px solid #ddd;
        padding: 0.55rem 0.9rem;
        border-radius: 999px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        width: 100%;
        justify-content: center;
        margin-top: 0.5rem;
      }

      .google-btn:hover {
        background: #f8f9fa;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      /* ===== Auth Forms ===== */
      .auth-form {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(3px);
      }

      .auth-form .form-container {
        background: var(--card-theme);
        padding: 1.4rem;
        border-radius: var(--radius);
        box-shadow: 0 16px 36px rgba(2, 6, 23, 0.16);
        width: 92%;
        max-width: 440px;
        border: 1px solid var(--border-theme);
        animation: fadeInUp 0.35s ease-out;
      }

      .auth-form h3 {
        text-align: center;
        margin: 0 0 1rem;
        color: var(--secondary);
        font-weight: 800;
        font-size: var(--h3-size);
      }

      .auth-form .error-message {
        color: #dc2626;
        margin-bottom: 1rem;
        text-align: center;
        font-size: var(--small-size);
      }

      .auth-form .switch-form {
        background: none;
        border: none;
        color: var(--primary);
        cursor: pointer;
        font-size: var(--small-size);
        font-weight: 800;
        display: block;
        margin: 0.6rem auto 0;
        text-align: center;
        width: 100%;
        padding: 0.4rem 0;
        transition: var(--transition);
      }

      .auth-form .switch-form:hover {
        color: var(--primary-light);
        text-decoration: underline;
      }

      @media (max-width: 780px) {
        .header__row {
          flex-wrap: wrap;
        }

        .header__title {
          order: 2;
          width: 100%;
          text-align: center;
        }

        .header__left {
          order: 1;
        }

        .header__right {
          order: 3;
          width: 100%;
          justify-content: center;
        }

        .search-wrap {
          padding-bottom: 0.85rem;
        }

        .settings-btn {
          left: 0.5rem;
          bottom: 0.5rem;
        }

        .settings-sidebar {
          width: 85%;
          left: -85%;
        }

        .theme-grid {
          grid-template-columns: 1fr;
        }

        .book__title {
          font-size: clamp(2.2rem, 5.2vw, 4.6rem);
          padding: 0 24px;
        }

        .book__subtitle {
          font-size: clamp(1rem, 2.2vw, 1.7rem);
          max-width: 85%;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .category,
      .dish,
      .recipe__content,
      .btn-wide {
        animation: fadeIn 0.35s ease-out;
      }

      /* Link preview styles */
      .link-preview-modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1001;
      }

      .link-preview-content {
        background: white;
        border-radius: var(--radius);
        width: 90%;
        max-width: 800px;
        height: 80vh;
        display: flex;
        flex-direction: column;
      }

      .link-preview-header {
        padding: 1rem;
        border-bottom: 1px solid var(--border-theme);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .link-preview-iframe {
        flex: 1;
        border: none;
        width: 100%;
      }

      .copy-link-btn {
        position: relative;
      }

      .copy-notification {
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--primary);
        color: white;
        padding: 0.3rem 0.6rem;
        border-radius: 6px;
        font-size: 0.8rem;
        white-space: nowrap;
      }

      /* Notification */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--primary);
        color: white;
        padding: 12px 20px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        z-index: 1002;
        animation: slideIn 0.3s ease;
        font-weight: 600;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      .page {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .auth-sheet {
        width: min(560px, 92%);
        padding: 10px 0;
      }

      .auth-sheet__title {
        margin: 0 0 0.35rem;
        font-weight: 950;
        color: #5a3a22;
        font-size: clamp(1.4rem, 3vw, 2rem);
      }
      .auth-sheet__sub {
        margin: 0 0 1.2rem;
        color: rgba(15, 23, 42, 0.55);
        font-weight: 700;
      }

      /* ===========================
   ORANGE MOBILE UI (OVERRIDES)
   Paste at the VERY END
   =========================== */

:root{
  --ui-bg: #f3f4f6;
  --ui-surface: #ffffff;
  --ui-surface-2: #f9fafb;
  --ui-shadow: 0 18px 40px rgba(2, 6, 23, 0.10);
  --ui-orange: #ea580c;
  --ui-orange-2: #f97316;
  --ui-orange-soft: #fff7ed;
  --ui-text: #0f172a;
  --ui-maxw: 500px;
}

body{
  background: var(--ui-bg) !important;
  color: var(--ui-text) !important;
}

/* phone shell */
.app-outer{
  min-height: 100vh;
  display: grid;
  place-items: center;
  padding: 16px;
}
.app-shell{
  width: 100%;
  max-width: var(--ui-maxw);
  min-height: 800px;
  background: var(--ui-surface-2);
  border: 1px solid rgba(2,6,23,0.10);
  border-radius: 28px;
  box-shadow: var(--ui-shadow);
  overflow: hidden;
  position: relative;
}

/* new topbar */
.topbar{
  position: sticky;
  top: 0;
  z-index: 50;
  background: var(--ui-surface);
  border-bottom: 1px solid rgba(2,6,23,0.06);
  padding: 18px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}
.brand{display:flex;align-items:center;gap:10px;min-width:0;}
.brand__icon{
  width: 40px;height:40px;border-radius:14px;
  background:#ffedd5;display:grid;place-items:center;flex:0 0 auto;
}
.brand__icon i{color:var(--ui-orange);font-size:18px;}
.brand__title{
  margin:0;font-weight:950;font-size:18px;letter-spacing:-0.2px;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.brand__title span{color:var(--ui-orange);}

/* header buttons */
.btn-ghost{
  display:inline-flex;align-items:center;gap:8px;
  border:1px solid rgba(2,6,23,0.06);
  background:#f8fafc;color:#64748b;
  padding:8px 12px;border-radius:12px;
  font-weight:800;cursor:pointer;transition:.18s ease;
}
.btn-ghost:hover{background:#f1f5f9;color:#0f172a;}

/* page padding */
.page{padding:18px;padding-bottom:92px;}

/* primary button */
.btn-primary{
  width:100%;border:0;background:var(--ui-orange);color:#fff;
  padding:14px;border-radius:14px;font-weight:950;cursor:pointer;
  box-shadow:0 16px 30px rgba(234, 88, 12, 0.22);
  display:inline-flex;align-items:center;justify-content:center;gap:10px;
  transition:.18s ease;
}
.btn-primary:hover{background:var(--ui-orange-2);transform:translateY(-1px);}
.btn-primary:active{transform:translateY(0) scale(0.99);}
.btn-plus{
  width:26px;height:26px;border-radius:999px;
  background:rgba(255,255,255,0.20);
  display:grid;place-items:center;
}

/* search */
.search2{margin-top:14px;position:relative;}
.search2 input{
  width:100%;
  border:1px solid rgba(2,6,23,0.10);
  background:var(--ui-surface);
  border-radius:14px;
  padding:13px 44px 13px 44px;
  font-weight:700;
  outline:none;
  box-shadow:0 8px 18px rgba(2,6,23,0.06);
}
.search2 .search-ico{
  position:absolute;left:14px;top:50%;
  transform:translateY(-50%);color:#94a3b8;
}
.search2 .clear-btn{
  position:absolute;right:10px;top:50%;
  transform:translateY(-50%);
  width:34px;height:34px;border-radius:12px;border:0;
  background:transparent;color:#94a3b8;cursor:pointer;
}
.search2 .clear-btn:hover{background:#f1f5f9;color:#0f172a;}

/* make old layout not fight */
.header, .search-wrap{display:none !important;}
.main{max-width:none !important;margin:0 !important;padding:0 !important;}

/* categories title */
.section-title{
  margin:18px 0 12px !important;
  font-size:20px !important;
  font-weight:950 !important;
  color: var(--ui-text) !important;
}

/* category card tweaks */
.card.category{
  border-radius:16px !important;
  border:1px solid rgba(2,6,23,0.06) !important;
  box-shadow:0 10px 18px rgba(2,6,23,0.06) !important;
}
.category__head{
  background: var(--ui-surface) !important;
  color: var(--ui-text) !important;
  border-bottom: 1px solid rgba(2,6,23,0.06);
}
.category__toggle{color:var(--ui-text) !important;}
.category__meta{color:#94a3b8 !important;}
.icon-btn{
  background:#fff !important;
  border:1px solid rgba(2,6,23,0.06) !important;
  color:#94a3b8 !important;
}
.icon-btn:hover{background:#f8fafc !important;color:#0f172a !important;}

/* dishes rows */
.dish{
  border-bottom:1px solid rgba(2,6,23,0.06) !important;
}
.dish:hover{background: rgba(234,88,12,0.06) !important;}
.icon-mini{
  border:1px solid rgba(2,6,23,0.06) !important;
}

/* settings fab */
.fab-settings{
  position:absolute;
  left:18px;bottom:18px;
  width:44px;height:44px;border-radius:999px;
  border:1px solid rgba(2,6,23,0.10);
  background:#fff;
  box-shadow:0 14px 26px rgba(2,6,23,0.10);
  color:#64748b;cursor:pointer;
  display:grid;place-items:center;
  transition:.22s ease;
  z-index: 60;
}
.fab-settings:hover{transform:rotate(90deg);color:#0f172a;}

/* ===== Mobile fix: нічого не "вилазить" ===== */
html, body { height: 100%; }
body { overflow-x: hidden; }

.app-outer { padding: 10px !important; }
.app-shell {
  max-width: 520px;
  width: 100%;
  height: 100dvh;
  min-height: 100dvh;
  border-radius: 22px;
  overflow: hidden;
}
.page {
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
@media (max-width: 520px){
  .app-outer { padding: 0 !important; }
  .app-shell { border-radius: 0; height: 100dvh; min-height: 100dvh; }
}

/* ===== FIX: головна сторінка не залазить під topbar ===== */
.topbar { position: sticky; top: 0; }

.page{
  padding-top: 22px !important; /* відступ від шапки */
}

/* щоб кнопка не виглядала обрізаною */
.btn-primary{
  margin-top: 6px !important;
}

/* список категорій — рівно і красиво */
#categories{
  display: grid;
  gap: 14px;
}

/* картки на всю ширину всередині "телефона" */
.card.category{
  width: 100%;
}

/* FIX: базові theme-змінні, щоб нічого не було "порожнім" */
:root{
  --bg-theme: var(--bg);
  --card-theme: var(--card);
  --border-theme: var(--border);
}

body.theme-default{
  --bg-theme: #f8fafc;
  --card-theme: #ffffff;
  --border-theme: #e5e7eb;
}

/* FIX: .page на головній сторінці не має центрувати контент */
.app-shell > .page{
  display: block !important;
  align-items: unset !important;
  justify-content: flex-start !important;
  height: auto !important;
}

/* щоб кнопка "Додати категорію" була нижче шапки і не прилипала */
#addCategoryBtn{
  margin-top: 10px !important;
}
/* ===== FIX SCROLL: скролиться тільки контент всередині телефону ===== */
html, body {
  height: 100%;
}

body {
  overflow: hidden !important; /* важливо: відключаємо скрол сайту */
}

/* телефон — фіксована висота екрану */
.app-shell {
  height: 100dvh !important;
  min-height: 100dvh !important;
  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important; /* щоб скрол не вилітав назовні */
}

/* шапка зверху */
.topbar {
  flex: 0 0 auto;
}

/* а отут має бути скрол */
.app-shell > .page {
  flex: 1 1 auto !important;
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* приберемо зайве центрування зовнішнього контейнера, яке може заважати */
.app-outer {
  min-height: 100vh !important;
  place-items: stretch !important;
  padding: 10px !important;
}
/* ===============================
   DISH LIST – FINAL POLISH
   =============================== */

/* контейнер одного рядка страви */
.dish-row,
.category-dish,
.dish-item {
  padding: 10px 12px !important;
  gap: 8px !important;
}

/* ⭐ зірка */
.dish-row .star,
.dish-row button svg {
  width: 16px !important;
  height: 16px !important;
}

/* назва страви */
.dish-row span,
.dish-name {
  font-size: 14px !important;          /* ↓ було ~16 */
  font-weight: 400 !important;         /* ↓ тонше */
  line-height: 1.35 !important;        /* компактно */
  color: #1f2937 !important;

  /* акуратна довжина */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* якщо хочеш дозволити 2 рядки замість одного — заміни блок вище на це */
/*
.dish-name {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
*/

/* кнопки редагування / видалення */
.dish-row .icon-btn,
.dish-row button {
  padding: 4px !important;
}

/* іконки edit / trash */
.dish-row svg {
  width: 15px !important;
  height: 15px !important;
  stroke-width: 1.6 !important; /* тонші лінії */
}

/* hover — дуже легкий */
.dish-row:hover {
  background: rgba(0,0,0,0.03) !important;
}
/* ==========================================================
   CLEAN UI OVERRIDE — (НЕ ЛАМАЄ ЛОГІКУ) — PASTE AT THE END
   Мета: акуратні списки + не жирні назви + нормальний скрол
   ========================================================== */

/* 1) Скрол: скролиться контент, а не весь сайт */
html, body { height: 100%; }
body { overflow: hidden !important; }

.app-shell{
  height: 100dvh !important;
  min-height: 100dvh !important;
  display: flex !important;
  flex-direction: column !important;
  overflow: hidden !important;
}

.topbar{ flex: 0 0 auto; }
.app-shell > .page{
  flex: 1 1 auto !important;
  overflow-y: auto !important;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* 2) Загальна типографіка — прибираємо "жир" */
:root{
  --fw-title: 650;
  --fw-subtitle: 550;
  --fw-text: 400;
  --fw-chip: 600;
}

body{
  font-weight: var(--fw-text) !important;
}

h1, h2, h3,
.header__title,
.section-title,
.result__title,
.recipe__title,
.video__title,
.social-links__title,
.settings-title,
.settings-section-title{
  font-weight: var(--fw-title) !important;
  letter-spacing: -0.2px;
}

/* категорія в шапці картки — НЕ жирна */
.category__toggle{
  font-weight: var(--fw-title) !important;   /* було 900 */
  font-size: 1rem !important;
}

.category__meta{
  font-weight: var(--fw-chip) !important;
  opacity: .9;
}

/* 3) Картки — трохи легше і чистіше */
.card{
  box-shadow: 0 10px 22px rgba(2, 6, 23, 0.06) !important;
  border-radius: 16px !important;
}

.card.category{
  overflow: hidden !important;
  border: 1px solid rgba(2,6,23,0.06) !important;
}

.category__head{
  padding: 12px 14px !important;
}

.category__body{
  padding: 12px 14px 14px !important;
}

/* 4) Іконки/кнопки — компактні і не грубі */
.icon-btn,
.icon-mini,
.icon-micro{
  font-weight: 600 !important;
  transform: none !important;
}

.icon-btn{
  width: 34px !important;
  height: 34px !important;
  border-radius: 12px !important;
}

.icon-mini{
  width: 34px !important;
  height: 34px !important;
  border-radius: 12px !important;
}

.icon-micro{
  width: 30px !important;
  height: 30px !important;
  border-radius: 10px !important;
}

/* 5) СТРАВИ — як на скріні: тонкий текст, компакт, 1 рядок з … */
.dish{
  padding: 10px 6px !important;
  gap: 10px !important;
  border-bottom: 1px solid rgba(2,6,23,0.06) !important;
  border-radius: 10px !important;
}

.dish:hover{
  background: rgba(2, 6, 23, 0.03) !important; /* легкий hover */
}

/* назва страви — НЕ жирна */
.dish__title{
  font-size: 0.98rem !important;
  font-weight: var(--fw-text) !important;   /* ВАЖЛИВО: було 900 */
  line-height: 1.35 !important;
  margin: 0 !important;
  max-width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* підпис/опис — легший */
.dish__sub{
  font-weight: 450 !important;
  opacity: .9;
}

/* тег "зірка" — менш жирний */
.tag{
  font-weight: 600 !important;
  font-size: 0.82rem !important;
}

/* 6) Список під-страв — теж не жирний */
.subdish__title{
  font-weight: 450 !important;
}

/* 7) Кнопки — зменшуємо “крик” */
.btn,
.btn-long,
.btn-wide,
.btn-outline,
.btn-back{
  font-weight: 650 !important;
}

/* 8) Рецепт — читабельніше */
.recipe__content{
  font-weight: 420 !important;
  font-size: 1rem !important;
  line-height: 1.85 !important;
}

/* 9) Пошук — не жирний */
.search__input{
  font-weight: 550 !important;
}
.search__input::placeholder{
  font-weight: 500 !important;
}

/* 10) На мобільних — щоб нічого не “різалось” */
@media (max-width: 520px){
  .app-outer{ padding: 0 !important; }
  .app-shell{ border-radius: 0 !important; }
  .category__head{ padding: 12px 12px !important; }
  .category__body{ padding: 12px 12px 14px !important; }
}
/* ХОВАЄМО "зірку" у правих кнопках дії (залишаємо ліву) */
.dish__actions .fav-btn,
.dish__actions .dish__fav,
.dish__actions .star-btn {
  display: none !important;
}

/* КНОПКА "Додати страву" — помаранчева */
.btn-long,
.add-dish-btn,
#addDishBtn {
  background: var(--ui-orange, #ea580c) !important;
  box-shadow: 0 16px 30px rgba(234, 88, 12, 0.22) !important;
}

.btn-long:hover,
.add-dish-btn:hover,
#addDishBtn:hover {
  background: var(--ui-orange-2, #f97316) !important;
}


    </style>
  </head>
  <body>
    <!-- ===== BOOK COVER ===== -->
    <div class="book-container" id="bookContainer">
      <div class="book" id="book">
        <div class="book__cover">
          <div class="book__ornament">
            <i class="fas fa-utensils"></i>
          </div>
          <h1 class="book__title">Cooking Book</h1>
          <p class="book__subtitle" id="bookSubtitle">
            Відкрийте свій кулінарний світ...
          </p>
          <div class="book__spine"></div>
        </div>
        <div class="book__pages">
          <div class="book__page-content">
            <!-- PAGE 1: LOADER -->
            <div class="page" id="pageLoader">
              <div class="book__loader">
                <div class="book__loader-circle"></div>
                <div class="book__loader-circle"></div>
                <div class="book__loader-circle"></div>
              </div>
              <div class="book__loading-text" id="loadingText">
                Завантаження...
              </div>
              <div class="book__loading-subtext" id="loadingSubtext"></div>
            </div>

            <!-- PAGE 2: AUTH (форма на странице книги) -->
            <div class="page" id="pageAuth" style="display: none">
              <div class="auth-sheet">
                <h2 class="auth-sheet__title">Увійдіть</h2>
                <p class="auth-sheet__sub">
                  Щоб зберігати ваші рецепти у хмарі
                </p>

                <!-- Тут мы используем ТВОИ уже готовые формы -->
                <div id="auth-menu-book" style="width: 100%">
                  <!-- копия твоего form-container -->
                  <div
                    class="form-container"
                    style="
                      box-shadow: none;
                      border: none;
                      width: 100%;
                      max-width: 520px;
                      background: transparent;
                      padding: 0;
                    "
                  >
                    <div id="login-form-book">
                      <h3
                        id="loginTitleBook"
                        style="text-align: center; margin: 0 0 1rem"
                      >
                        Увійти
                      </h3>
                      <div id="login-error-book" class="error-message"></div>

                      <input
                        type="email"
                        id="login-email-book"
                        placeholder="Email"
                        style="
                          width: 100%;
                          padding: 0.8rem 1rem;
                          border: 1px solid var(--border-theme);
                          border-radius: var(--radius);
                          margin-bottom: 0.8rem;
                          font-size: 1rem;
                        "
                      />

                      <input
                        type="password"
                        id="login-password-book"
                        placeholder="Пароль"
                        style="
                          width: 100%;
                          padding: 0.8rem 1rem;
                          border: 1px solid var(--border-theme);
                          border-radius: var(--radius);
                          margin-bottom: 0.8rem;
                          font-size: 1rem;
                        "
                      />

                      <button
                        class="btn-wide"
                        style="width: 100%"
                        id="loginBtnBook"
                      >
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Увійти</span>
                      </button>

                      <button class="google-btn" id="googleLoginBtnBook">
                        <i class="fab fa-google"></i>
                        <span>Увійти через Google</span>
                      </button>

                      <button class="switch-form" id="registerSwitchTextBook">
                        <i class="fas fa-user-plus"></i>
                        <span>Зареєструватися</span>
                      </button>
                    </div>

                    <div id="register-form-book" style="display: none">
                      <h3
                        id="registerTitleBook"
                        style="text-align: center; margin: 0 0 1rem"
                      >
                        Реєстрація
                      </h3>
                      <div id="register-error-book" class="error-message"></div>

                      <input
                        type="text"
                        id="register-name-book"
                        placeholder="Ім'я"
                        style="
                          width: 100%;
                          padding: 0.8rem 1rem;
                          border: 1px solid var(--border-theme);
                          border-radius: var(--radius);
                          margin-bottom: 0.8rem;
                          font-size: 1rem;
                        "
                      />

                      <input
                        type="email"
                        id="register-email-book"
                        placeholder="Email"
                        style="
                          width: 100%;
                          padding: 0.8rem 1rem;
                          border: 1px solid var(--border-theme);
                          border-radius: var(--radius);
                          margin-bottom: 0.8rem;
                          font-size: 1rem;
                        "
                      />

                      <input
                        type="password"
                        id="register-password-book"
                        placeholder="Пароль"
                        style="
                          width: 100%;
                          padding: 0.8rem 1rem;
                          border: 1px solid var(--border-theme);
                          border-radius: var(--radius);
                          margin-bottom: 0.8rem;
                          font-size: 1rem;
                        "
                      />

                      <input
                        type="password"
                        id="register-confirm-password-book"
                        placeholder="Підтвердіть пароль"
                        style="
                          width: 100%;
                          padding: 0.8rem 1rem;
                          border: 1px solid var(--border-theme);
                          border-radius: var(--radius);
                          margin-bottom: 1rem;
                          font-size: 1rem;
                        "
                      />

                      <button
                        class="btn-wide"
                        style="width: 100%"
                        id="registerBtnBook"
                      >
                        <i class="fas fa-user-plus"></i>
                        <span>Зареєструватися</span>
                      </button>

                      <button class="switch-form" id="loginSwitchTextBook">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Вже маєте акаунт? Увійти</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== MAIN CONTENT WRAPPER ===== -->
   <div class="main-content" id="mainContent">
      <div class="app-outer">
      <div class="app-shell">

      <!-- ===== HEADER ===== -->
      <header class="topbar">
  <div class="brand">
    <div class="brand__icon">
      <i class="fas fa-hat-chef"></i>
    </div>
    <h1 class="brand__title" id="appTitle">Кулінарна<span>Книга</span></h1>
  </div>

  <button class="btn-ghost" id="authButton" type="button">
    <i class="fas fa-right-from-bracket"></i>
    <span id="authText">Увійти</span>
  </button>
</header>

<div class="page">
  <button class="btn-primary" type="button" id="addCategoryBtn">
    <span class="btn-plus"><i class="fas fa-plus"></i></span>
    <span id="addCategoryText">Додати категорію</span>
  </button>

  <div class="search2" id="searchWrap">
    <i class="fas fa-magnifying-glass search-ico"></i>
    <input
      id="searchBar"
      type="search"
      placeholder="Пошук: категорія або страва…"
      autocomplete="off"
    />
    <button class="clear-btn" type="button" id="clearSearchBtn" aria-label="Очистити пошук">
      <i class="fas fa-xmark"></i>
    </button>
  </div>

      <!-- ===== Кнопка настроек ===== -->
      <button class="fab-settings" id="settingsBtn" aria-label="Налаштування">
  <i class="fas fa-cog"></i>
</button>

      <!-- ===== Сайдбар настроек ===== -->
      <div class="settings-overlay" id="settingsOverlay"></div>
      <div class="settings-sidebar" id="settingsSidebar">
        <h2 class="settings-title" id="settingsTitle">Налаштування</h2>

        <div class="settings-section">
          <h3 class="settings-section-title" id="themeTitle">Постельні тони</h3>
          <div class="theme-grid">
            <div
              class="theme-option"
              data-theme="default"
              style="
                background: linear-gradient(135deg, #1c6204, #35da0d);
                color: white;
              "
            >
              <i class="fas fa-leaf"></i>
              <span>Зелений</span>
            </div>
            <div
              class="theme-option"
              data-theme="soft"
              style="
                background: linear-gradient(135deg, #9333ea, #c084fc);
                color: white;
              "
            >
              <i class="fas fa-cloud"></i>
              <span>Лаванда</span>
            </div>
            <div
              class="theme-option"
              data-theme="warm"
              style="
                background: linear-gradient(135deg, #ea580c, #fb923c);
                color: white;
              "
            >
              <i class="fas fa-fire"></i>
              <span>Персик</span>
            </div>
            <div
              class="theme-option"
              data-theme="cool"
              style="
                background: linear-gradient(135deg, #0284c7, #38bdf8);
                color: white;
              "
            >
              <i class="fas fa-snowflake"></i>
              <span>Блакитний</span>
            </div>
            <div
              class="theme-option"
              data-theme="rose"
              style="
                background: linear-gradient(135deg, #e11d48, #fb7185);
                color: white;
              "
            >
              <i class="fas fa-heart"></i>
              <span>Рожевий</span>
            </div>
            <div
              class="theme-option"
              data-theme="mint"
              style="
                background: linear-gradient(135deg, #16a34a, #4ade80);
                color: white;
              "
            >
              <i class="fas fa-leaf"></i>
              <span>М'ятний</span>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h3 class="settings-section-title" id="subDishesTitle">
            Функція підблюд
          </h3>
          <div class="toggle-switch">
            <span class="toggle-label" id="subDishesLabel"
              >Увімкнути підблюда</span
            >
            <label class="toggle-input">
              <input type="checkbox" id="subDishesToggle" />
              <span class="toggle-slider"></span>
            </label>
          </div>
          <p
            style="font-size: 0.85rem; color: var(--muted); margin: 0.5rem 0 0"
          >
            <i class="fas fa-info-circle"></i>
            <span id="subDishesDesc"
              >Дозволяє додавати підблюда до основних страв (наприклад: салат →
              м'ясний салат)</span
            >
          </p>
        </div>

        <div class="settings-section">
          <h3 class="settings-section-title" id="textSizeTitle">
            Розмір тексту
          </h3>
          <div class="size-control">
            <span class="size-label" id="baseFontLabel">Базовий розмір:</span>
            <span class="size-value" id="baseFontValue">18</span>
            <input
              type="range"
              min="14"
              max="24"
              value="18"
              class="size-slider"
              id="baseFontSlider"
            />
          </div>
          <div class="size-control">
            <span class="size-label" id="buttonSizeLabel">Розмір кнопок:</span>
            <span class="size-value" id="buttonSizeValue">16</span>
            <input
              type="range"
              min="12"
              max="20"
              value="16"
              class="size-slider"
              id="buttonSizeSlider"
            />
          </div>
        </div>

        <div class="settings-section">
          <h3 class="settings-section-title" id="languageTitle">Мова</h3>
          <div class="language-selector">
            <button class="lang-btn active" data-lang="uk">
              <i class="fas fa-language"></i>
              <span>Українська</span>
            </button>
            <button class="lang-btn" data-lang="en">
              <i class="fas fa-language"></i>
              <span>English</span>
            </button>
            <button class="lang-btn" data-lang="hy">
              <i class="fas fa-language"></i>
              <span>Հայերեն</span>
            </button>
          </div>
        </div>

        <button class="btn-long" id="saveSettingsBtn">
          <i class="fas fa-save"></i>
          <span>Зберегти налаштування</span>
        </button>
      </div>

      <!-- ===== Main Content ===== -->
      <main class="main">
        <!-- ===== SCREEN: MAIN (категорії) ===== -->
        <section class="screen is-active" id="screen-main">
          <h2 class="section-title" id="categoriesTitle">Категорії страв</h2>

          <!-- Search Results -->
          <div
            class="search-results"
            id="search-results"
            style="display: none"
          ></div>

          <!-- ===== CATEGORIES LIST ===== -->
          <div class="empty" id="empty-categories" style="display: none">
            <i class="fas fa-utensils"></i>
            <p id="emptyCategoriesText">
              Поки що немає категорій. Натисніть "Додати категорію".
            </p>
          </div>
          <div id="categories">
            <!-- Категорії будуть додані через JS -->
          </div>
        </section>

        <!-- ===== SCREEN: ADD CATEGORY ===== -->
        <section class="screen" id="screen-add">
          <div class="back-row">
            <button class="btn-back" type="button" id="backFromAddBtn">
              <i class="fas fa-arrow-left"></i>
              <span id="backText">Назад</span>
            </button>
            <span class="hint" id="addCategoryHint">Додаємо категорію</span>
          </div>

          <h2 class="section-title" id="addCategoryTitle">Додати категорію</h2>

          <div class="card" style="padding: 1rem">
            <label class="hint" for="new-category-name" id="categoryNameLabel"
              >Назва категорії</label
            >
            <input
              id="new-category-name"
              type="text"
              placeholder="Наприклад: Салати"
              style="
                width: 100%;
                margin: 0.35rem 0 0.8rem;
                padding: 0.85rem 1rem;
                border: 1px solid var(--border-theme);
                border-radius: 14px;
                font-size: 1rem;
                font-weight: 650;
              "
            />
            <button class="btn-wide" type="button" id="addCategoryConfirmBtn">
              <i class="fas fa-plus"></i>
              <span id="addConfirmText">Додати</span>
            </button>
          </div>
        </section>

        <!-- ===== SCREEN: RECIPE VIEW ===== -->
        <section class="screen" id="screen-recipe">
          <div class="back-row">
            <button class="btn-back" type="button" id="backFromRecipeBtn">
              <i class="fas fa-arrow-left"></i>
              <span id="backText2">Назад</span>
            </button>
            <div class="tag star" id="favorite-tag" style="display: none">
  <i class="fas fa-star"></i>
</div>
          </div>

          <article class="card recipe">
            <h2 class="recipe__title" id="recipe-title">
              <span id="recipe-name">Назва страви</span>
              <span class="tag" id="recipe-category-tag">
                <i class="fas fa-folder"></i>
                <span id="categoryText">Категорія: ...</span>
              </span>
            </h2>

            <div
              class="recipe__content"
              id="recipe-display"
              contenteditable="false"
            >
              Текст рецепту...
            </div>

            <div class="recipe__tools" id="recipe-tools" style="display: none">
              <button class="btn-wide" type="button" id="saveRecipeBtn">
                <i class="fas fa-save"></i>
                <span id="saveText">Зберегти</span>
              </button>
              <button
                class="btn-wide"
                type="button"
                id="cancelEditBtn"
                style="
                  background: var(--card-theme);
                  color: var(--primary);
                  border: 2px solid var(--primary);
                  box-shadow: none;
                "
              >
                <i class="fas fa-times"></i>
                <span id="cancelText">Скасувати</span>
              </button>
            </div>

            <button class="btn-wide" type="button" id="editRecipeBtn">
              <i class="fas fa-edit"></i>
              <span id="editText">Редагувати</span>
            </button>

            <!-- ===== VIDEO ===== -->
            <div class="video" id="video-block" style="display: none">
              <div class="video__top">
                <p class="video__title">
                  <i class="fas fa-video"></i>
                  <span id="videoTitle">Відео</span>
                </p>
                <button class="btn-outline" type="button" id="addVideoBtn">
                  <i class="fas fa-plus"></i>
                  <span id="addVideoText">Додати посилання</span>
                </button>
              </div>

              <div class="video__link" id="video-link" style="display: none">
                <span id="linkText">Посилання:</span>
                <a
                  href="#"
                  target="_blank"
                  rel="noopener noreferrer"
                  id="video-url"
                  >https://youtu.be/xxxxxxx</a
                >
              </div>

              <div class="video__frame" id="video-frame" style="display: none">
                <iframe
                  title="YouTube відео"
                  src=""
                  allow="
                    accelerometer;
                    autoplay;
                    clipboard-write;
                    encrypted-media;
                    gyroscope;
                    picture-in-picture;
                    web-share;
                  "
                  allowfullscreen
                  id="video-iframe"
                ></iframe>
              </div>

              <div class="video__note">
                <i class="fas fa-lightbulb"></i>
                <span id="videoNote"
                  >Порада: можна зберігати звичайне посилання на YouTube — я
                  покажу кнопку для перегляду і (за бажанням) вбудую
                  відео.</span
                >
              </div>
            </div>

            <!-- ===== SOCIAL LINKS ===== -->
            <div
              class="social-links"
              id="social-links-block"
              style="display: none"
            >
              <div class="social-links__top">
                <p class="social-links__title">
                  <i class="fas fa-share-alt"></i>
                  <span id="socialLinksTitle">Соціальні посилання</span>
                </p>
                <button class="btn-outline" type="button" id="addSocialLinkBtn">
                  <i class="fas fa-plus"></i>
                  <span id="addSocialLinkText">Додати посилання</span>
                </button>
              </div>

              <div class="social-links__list" id="social-links-list">
                <!-- Социальные ссылки будут добавляться здесь -->
              </div>
            </div>
          </article>
        </section>
      </main>
      </div>

      <!-- ===== Auth Forms ===== -->
      <div id="auth-menu" class="auth-form" style="display: none">
        <div class="form-container">
          <div id="login-form">
            <h3 id="loginTitle">Увійти</h3>
            <div id="login-error" class="error-message"></div>
            <input
              type="email"
              id="login-email"
              placeholder="Email"
              style="
                width: 100%;
                padding: 0.8rem 1rem;
                border: 1px solid var(--border-theme);
                border-radius: var(--radius);
                margin-bottom: 0.8rem;
                font-size: 1rem;
              "
            />
            <input
              type="password"
              id="login-password"
              placeholder="Пароль"
              style="
                width: 100%;
                padding: 0.8rem 1rem;
                border: 1px solid var(--border-theme);
                border-radius: var(--radius);
                margin-bottom: 0.8rem;
                font-size: 1rem;
              "
            />
            <button class="btn-wide" style="width: 100%" id="loginBtn">
              <i class="fas fa-sign-in-alt"></i>
              <span id="loginBtnText">Увійти</span>
            </button>
            <button class="google-btn" id="googleLoginBtn">
              <i class="fab fa-google"></i>
              <span>Увійти через Google</span>
            </button>
            <button class="switch-form" id="registerSwitchText">
              <i class="fas fa-user-plus"></i>
              <span>Зареєструватися</span>
            </button>
          </div>
          <div id="register-form" style="display: none">
            <h3 id="registerTitle">Реєстрація</h3>
            <div id="register-error" class="error-message"></div>
            <input
              type="text"
              id="register-name"
              placeholder="Ім'я"
              style="
                width: 100%;
                padding: 0.8rem 1rem;
                border: 1px solid var(--border-theme);
                border-radius: var(--radius);
                margin-bottom: 0.8rem;
                font-size: 1rem;
              "
            />
            <input
              type="email"
              id="register-email"
              placeholder="Email"
              style="
                width: 100%;
                padding: 0.8rem 1rem;
                border: 1px solid var(--border-theme);
                border-radius: var(--radius);
                margin-bottom: 0.8rem;
                font-size: 1rem;
              "
            />
            <input
              type="password"
              id="register-password"
              placeholder="Пароль"
              style="
                width: 100%;
                padding: 0.8rem 1rem;
                border: 1px solid var(--border-theme);
                border-radius: var(--radius);
                margin-bottom: 0.8rem;
                font-size: 1rem;
              "
            />
            <input
              type="password"
              id="register-confirm-password"
              placeholder="Підтвердіть пароль"
              style="
                width: 100%;
                padding: 0.8rem 1rem;
                border: 1px solid var(--border-theme);
                border-radius: var(--radius);
                margin-bottom: 1rem;
                font-size: 1rem;
              "
            />
            <button class="btn-wide" style="width: 100%" id="registerBtn">
              <i class="fas fa-user-plus"></i>
              <span id="registerBtnText">Зареєструватися</span>
            </button>
            <button class="switch-form" id="loginSwitchText">
              <i class="fas fa-sign-in-alt"></i>
              <span>Вже маєте акаунт? Увійти</span>
            </button>
          </div>
        </div>
      </div>

      <!-- ===== Link Preview Modal ===== -->
      <div
        class="link-preview-modal"
        id="linkPreviewModal"
        style="display: none"
      >
        <div class="link-preview-content">
          <div class="link-preview-header">
            <h3 style="margin: 0" id="previewTitle">Перегляд посилання</h3>
            <button class="btn" id="closePreviewBtn">
              <i class="fas fa-times"></i>
              <span id="closePreviewText">Закрити</span>
            </button>
          </div>
          <iframe class="link-preview-iframe" id="linkPreviewIframe"></iframe>
        </div>
      </div>
      </div>
    </div>
    </div>
    </div>

    <script>
      // ==================== КОНФИГУРАЦИЯ FIREBASE ====================
      const firebaseConfig = {
        apiKey: "AIzaSyCsi129Y9ltNjMbNPU8D9s1JURMxVyeHYs",
        authDomain: "notebook-66f4e.firebaseapp.com",
        databaseURL: "https://notebook-66f4e-default-rtdb.firebaseio.com",
        projectId: "notebook-66f4e",
        storageBucket: "notebook-66f4e.appspot.com",
        messagingSenderId: "1234567890",
        appId: "1:1234567890:web:abcdef1234567890",
      };

      // Инициализация Firebase
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.database();

      // Глобальные переменные
      let currentUser = null;
      let currentCat = null;
      let currentDish = null;
      let currentSubdish = null;

      // Переменные для поиска
      let searchCache = {
        categories: {},
        flatCats: [],
        flatDishes: [],
      };

      // Текущий язык
      let currentLanguage = "uk";

      // Флаг подблюд
      let subDishesEnabled = false;

      // ==================== ЛОКАЛИЗАЦИЯ ====================
      const translations = {
        uk: {
          appTitle: "Кулінарна книга",
          categoriesTitle: "Категорії страв",
          addCategoryTitle: "Додати категорію",

          authText: "Увійти",
          logoutText: "Вийти",
          addCategoryText: "Додати категорію",
          backText: "Назад",
          addConfirmText: "Додати",
          editText: "Редагувати",
          saveText: "Зберегти",
          cancelText: "Скасувати",
          favoriteText: "Улюблене",
          categoryText: "Категорія: ",

          addSubdishText: "Додати підблюдо",
          editSubdishText: "Редагувати підблюдо",
          deleteSubdishText: "Видалити підблюдо",
          subdishLabel: "Підблюдо:",
          enterSubdishName: "Назва підблюда:",
          confirmDeleteSubdish: "Видалити підблюдо?",

          addCategoryHint: "Додаємо категорію",
          categoryNameLabel: "Назва категорії",
          emptyCategoriesText:
            'Поки що немає категорій. Натисніть "Додати категорію".',

          videoTitle: "Відео",
          addVideoText: "Додати посилання",
          linkText: "Посилання:",
          videoNote:
            "Порада: можна зберігати звичайне посилання на YouTube — я покажу кнопку для перегляду і (за бажанням) вбудую відео.",

          socialLinksTitle: "Соціальні посилання",
          addSocialLinkText: "Додати посилання",
          copyLinkText: "Копіювати",
          viewLinkText: "Перегляд",
          deleteLinkText: "Видалити",

          settingsTitle: "Налаштування",
          themeTitle: "Постельні тони",
          subDishesTitle: "Функція підблюд",
          subDishesLabel: "Увімкнути підблюда",
          subDishesDesc:
            "Дозволяє додавати підблюда до основних страв (наприклад: салат → м'ясний салат)",
          textSizeTitle: "Розмір тексту",
          baseFontLabel: "Базовий розмір:",
          buttonSizeLabel: "Розмір кнопок:",
          languageTitle: "Мова",
          saveSettingsBtn: "Зберегти налаштування",

          loginTitle: "Увійти",
          loginBtnText: "Увійти",
          registerTitle: "Реєстрація",
          registerBtnText: "Зареєструватися",
          registerSwitchText: "Зареєструватися",
          loginSwitchText: "Вже маєте акаунт? Увійти",

          previewTitle: "Перегляд посилання",
          closePreviewText: "Закрити",

          searchPlaceholder:
            "Пошук: категорія або страва… (наприклад: борщ, салат, улюблене)",

          confirmDeleteCategory: "Видалити категорію разом з усіма стравами?",
          confirmDeleteDish: "Видалити страву?",
          confirmDeleteLink: "Видалити посилання?",
          enterCategoryName: "Введіть назву категорії",
          enterDishName: "Назва страви:",
          enterVideoUrl: "Вставте посилання на відео (YouTube):",
          enterSocialUrl: "Вставте посилання на соціальну мережу:",
          selectPlatform: "Виберіть платформу:",
          linkCopied: "Посилання скопійовано!",
          noAccountAlert: "Спочатку увійдіть у свій акаунт.",
          settingsSaved: "Налаштування збережено!",
          passwordsNotMatch: "Паролі не співпадають",
        },
        en: {
          appTitle: "Cookbook",
          categoriesTitle: "Dish Categories",
          addCategoryTitle: "Add Category",

          authText: "Login",
          logoutText: "Logout",
          addCategoryText: "Add Category",
          backText: "Back",
          addConfirmText: "Add",
          editText: "Edit",
          saveText: "Save",
          cancelText: "Cancel",
          favoriteText: "Favorite",
          categoryText: "Category: ",

          addSubdishText: "Add sub-dish",
          editSubdishText: "Edit sub-dish",
          deleteSubdishText: "Delete sub-dish",
          subdishLabel: "Sub-dish:",
          enterSubdishName: "Sub-dish name:",
          confirmDeleteSubdish: "Delete sub-dish?",

          addCategoryHint: "Adding category",
          categoryNameLabel: "Category name",
          emptyCategoriesText: 'No categories yet. Click "Add Category".',

          videoTitle: "Video",
          addVideoText: "Add link",
          linkText: "Link:",
          videoNote:
            "Tip: you can save a regular YouTube link - I'll show a button to view and (optional) embed the video.",

          socialLinksTitle: "Social Links",
          addSocialLinkText: "Add link",
          copyLinkText: "Copy",
          viewLinkText: "View",
          deleteLinkText: "Delete",

          settingsTitle: "Settings",
          themeTitle: "Bedroom Tones",
          subDishesTitle: "Sub-dishes Function",
          subDishesLabel: "Enable sub-dishes",
          subDishesDesc:
            "Allows adding sub-dishes to main dishes (e.g.: salad → meat salad)",
          textSizeTitle: "Text Size",
          baseFontLabel: "Base size:",
          buttonSizeLabel: "Button size:",
          languageTitle: "Language",
          saveSettingsBtn: "Save Settings",

          loginTitle: "Login",
          loginBtnText: "Login",
          registerTitle: "Registration",
          registerBtnText: "Register",
          registerSwitchText: "Register",
          loginSwitchText: "Already have an account? Login",

          previewTitle: "Link Preview",
          closePreviewText: "Close",

          searchPlaceholder:
            "Search: category or dish… (for example: borscht, salad, favorite)",

          confirmDeleteCategory: "Delete category with all dishes?",
          confirmDeleteDish: "Delete dish?",
          confirmDeleteLink: "Delete link?",
          enterCategoryName: "Enter category name",
          enterDishName: "Dish name:",
          enterVideoUrl: "Paste video link (YouTube):",
          enterSocialUrl: "Paste social media link:",
          selectPlatform: "Select platform:",
          linkCopied: "Link copied!",
          noAccountAlert: "Please log in to your account first.",
          settingsSaved: "Settings saved!",
          passwordsNotMatch: "Passwords do not match",
        },
        hy: {
          appTitle: "Խոհարարական գիրք",
          categoriesTitle: "Ուտեստների կատեգորիաներ",
          addCategoryTitle: "Ավելացնել կատեգորիա",

          authText: "Մուտք",
          logoutText: "Ելք",
          addCategoryText: "Ավելացնել կատեգորիա",
          backText: "Հետ",
          addConfirmText: "Ավելացնել",
          editText: "Խմբագրել",
          saveText: "Պահպանել",
          cancelText: "Չեղարկել",
          favoriteText: "Սիրված",
          categoryText: "Կատեգորիա: ",

          addSubdishText: "Ավելացնել ենթաճաշ",
          editSubdishText: "Խմբագրել ենթաճաշ",
          deleteSubdishText: "Ջնջել ենթաճաշ",
          subdishLabel: "Ենթաճաշ:",
          enterSubdishName: "Ենթաճաշի անվանումը:",
          confirmDeleteSubdish: "Ջնջել ենթաճաշը:",

          addCategoryHint: "Ավելացնում ենք կատեգորիա",
          categoryNameLabel: "Կատեգորիայի անվանումը",
          emptyCategoriesText:
            'Դեռ կատեգորիաներ չկան: Սեղմեք "Ավելացնել կատեգորիա".',

          videoTitle: "Տեսանյութ",
          addVideoText: "Ավելացնել հղում",
          linkText: "Հղում:",
          videoNote:
            "Հուշում: կարող եք պահել սովորական YouTube հղումը - ես ցույց կտամ դիտելու կոճակը և (ըստ ցանկության) ներդնել տեսանյութը:",

          socialLinksTitle: "Սոցիալական հղումներ",
          addSocialLinkText: "Ավելացնել հղում",
          copyLinkText: "Պատճենել",
          viewLinkText: "Դիտել",
          deleteLinkText: "Ջնջել",

          settingsTitle: "Կարգավորումներ",
          themeTitle: "Պաստելային երանգներ",
          subDishesTitle: "Ենթաճաշերի ֆունկցիա",
          subDishesLabel: "Միացնել ենթաճաշերը",
          subDishesDesc:
            "Թույլ է տալիս ավելացնել ենթաճաշեր հիմնական ճաշերին (օրինակ՝ աղցան → մսային աղցան)",
          textSizeTitle: "Տեքստի չափը",
          baseFontLabel: "Հիմնական չափը:",
          buttonSizeLabel: "Կոճակների չափը:",
          languageTitle: "Լեզու",
          saveSettingsBtn: "Պահպանել կարգավորումները",

          loginTitle: "Մուտք",
          loginBtnText: "Մուտք",
          registerTitle: "Գրանցում",
          registerBtnText: "Գրանցվել",
          registerSwitchText: "Գրանցվել",
          loginSwitchText: "Արդեն ունեք հաշիվ: Մուտք",

          previewTitle: "Հղման նախադիտում",
          closePreviewText: "Փակել",

          searchPlaceholder:
            "Որոնում: կատեգորիա կամ ուտեստ… (օրինակ՝ բորշչ, աղցան, սիրված)",

          confirmDeleteCategory: "Ջնջել կատեգորիան բոլոր ուտեստներով միասին:",
          confirmDeleteDish: "Ջնջել ուտեստը:",
          confirmDeleteLink: "Ջնջել հղումը:",
          enterCategoryName: "Մուտքագրեք կատեգորիայի անվանումը",
          enterDishName: "Ուտեստի անվանումը:",
          enterVideoUrl: "Կպցրեք տեսանյութի հղումը (YouTube):",
          enterSocialUrl: "Կպցրեք սոցիալական ցանցի հղումը:",
          selectPlatform: "Ընտրեք հարթակը:",
          linkCopied: "Հղումը պատճենվել է:",
          noAccountAlert: "Նախ մուտք գործեք ձեր հաշիվ:",
          settingsSaved: "Կարգավորումները պահպանված են:",
          passwordsNotMatch: "Գաղտնաբառերը չեն համընկնում",
        },
      };

      function setLanguage(lang) {
  currentLanguage = lang;

  const html = document.getElementById("html-lang");
  if (html) html.lang = lang;

  const t = translations[lang] || translations.uk;

  // helper: ставимо текст тільки якщо елемент існує
  const setText = (id, value) => {
    const el = document.getElementById(id);
    if (el) el.textContent = value;
  };
  const setPlaceholder = (id, value) => {
    const el = document.getElementById(id);
    if (el) el.placeholder = value;
  };

  setText("appTitle", t.appTitle);
  setText("page-title", t.appTitle);
  setText("categoriesTitle", t.categoriesTitle);
  setText("addCategoryTitle", t.addCategoryTitle);

  setText("authText", currentUser ? t.logoutText : t.authText);
  setText("addCategoryText", t.addCategoryText);
  setText("backText", t.backText);
  setText("backText2", t.backText);
  setText("addConfirmText", t.addConfirmText);
  setText("editText", t.editText);
  setText("saveText", t.saveText);
  setText("cancelText", t.cancelText);

  // favoriteText ТИ ВИДАЛИВ — тому не чіпаємо його взагалі

  setText("categoryText", t.categoryText);
  setText("addCategoryHint", t.addCategoryHint);
  setText("categoryNameLabel", t.categoryNameLabel);
  setText("emptyCategoriesText", t.emptyCategoriesText);

  setText("videoTitle", t.videoTitle);
  setText("addVideoText", t.addVideoText);
  setText("linkText", t.linkText);
  setText("videoNote", t.videoNote);

  setText("socialLinksTitle", t.socialLinksTitle);
  setText("addSocialLinkText", t.addSocialLinkText);

  setText("settingsTitle", t.settingsTitle);
  setText("themeTitle", t.themeTitle);
  setText("textSizeTitle", t.textSizeTitle);
  setText("baseFontLabel", t.baseFontLabel);
  setText("buttonSizeLabel", t.buttonSizeLabel);
  setText("languageTitle", t.languageTitle);
  setText("saveSettingsBtn", t.saveSettingsBtn);

  setText("loginTitle", t.loginTitle);
  setText("loginBtnText", t.loginBtnText);
  setText("registerTitle", t.registerTitle);
  setText("registerBtnText", t.registerBtnText);
  setText("registerSwitchText", t.registerSwitchText);
  setText("loginSwitchText", t.loginSwitchText);

  setText("previewTitle", t.previewTitle);
  setText("closePreviewText", t.closePreviewText);

  // ✅ у тебе пошук тепер id="searchBar"
  setPlaceholder("searchBar", t.searchPlaceholder);

  document.querySelectorAll(".lang-btn").forEach((btn) => {
    btn.classList.toggle("active", btn.getAttribute("data-lang") === lang);
  });

  localStorage.setItem("preferredLanguage", lang);
}

      // ==================== НАСТРОЙКИ ====================
      function loadSettings() {
        const savedBaseFont = localStorage.getItem("baseFontSize");
        const savedButtonFont = localStorage.getItem("buttonFontSize");
        const savedLanguage = localStorage.getItem("preferredLanguage");
        const savedTheme = localStorage.getItem("theme");
        const savedSubDishes = localStorage.getItem("subDishesEnabled");

        if (savedBaseFont) {
          document.documentElement.style.setProperty(
            "--base-font-size",
            savedBaseFont + "px",
          );
          document.getElementById("baseFontSlider").value = savedBaseFont;
          document.getElementById("baseFontValue").textContent = savedBaseFont;
          updateFontSizes(parseInt(savedBaseFont));
        }

        if (savedButtonFont) {
          document.documentElement.style.setProperty(
            "--button-font-size",
            savedButtonFont + "px",
          );
          document.getElementById("buttonSizeSlider").value = savedButtonFont;
          document.getElementById("buttonSizeValue").textContent =
            savedButtonFont;
          updateButtonPadding(parseInt(savedButtonFont));
        }

        if (savedTheme) {
          document.body.className = "";
          document.body.classList.add(`theme-${savedTheme}`);
          document.querySelectorAll(".theme-option").forEach((option) => {
            option.classList.remove("selected");
            if (option.getAttribute("data-theme") === savedTheme) {
              option.classList.add("selected");
            }
          });
        }

        if (savedSubDishes) {
          subDishesEnabled = savedSubDishes === "true";
          document.getElementById("subDishesToggle").checked = subDishesEnabled;
        }

        if (savedLanguage && translations[savedLanguage]) {
          setLanguage(savedLanguage);
        }
      }

      function updateFontSizes(baseSize) {
        document.documentElement.style.setProperty(
          "--h1-size",
          (baseSize * 1.55) / 18 + "rem",
        );
        document.documentElement.style.setProperty(
          "--h2-size",
          (baseSize * 1.25) / 18 + "rem",
        );
        document.documentElement.style.setProperty(
          "--h3-size",
          (baseSize * 1.1) / 18 + "rem",
        );
        document.documentElement.style.setProperty(
          "--p-size",
          (baseSize * 1) / 18 + "rem",
        );
        document.documentElement.style.setProperty(
          "--small-size",
          (baseSize * 0.92) / 18 + "rem",
        );
      }

      function updateButtonPadding(buttonSize) {
        const paddingVertical = (buttonSize * 0.58) / 16 + "rem";
        const paddingHorizontal = (buttonSize * 0.9) / 16 + "rem";
        document.documentElement.style.setProperty(
          "--button-padding",
          `${paddingVertical} ${paddingHorizontal}`,
        );
      }

      function saveSettings() {
        const baseFontSize = document.getElementById("baseFontSlider").value;
        const buttonFontSize =
          document.getElementById("buttonSizeSlider").value;

        localStorage.setItem("baseFontSize", baseFontSize);
        localStorage.setItem("buttonFontSize", buttonFontSize);

        document.documentElement.style.setProperty(
          "--base-font-size",
          baseFontSize + "px",
        );
        document.documentElement.style.setProperty(
          "--button-font-size",
          buttonFontSize + "px",
        );

        updateFontSizes(parseInt(baseFontSize));
        updateButtonPadding(parseInt(buttonFontSize));

        const selectedTheme = document.querySelector(".theme-option.selected");
        if (selectedTheme) {
          const theme = selectedTheme.getAttribute("data-theme");
          document.body.className = "";
          document.body.classList.add(`theme-${theme}`);
          localStorage.setItem("theme", theme);
        }

        subDishesEnabled = document.getElementById("subDishesToggle").checked;
        localStorage.setItem("subDishesEnabled", subDishesEnabled);

        closeSettings();
        showNotification(translations[currentLanguage].settingsSaved);
      }

      function initSettings() {
        const settingsBtn = document.getElementById("settingsBtn");
        const settingsOverlay = document.getElementById("settingsOverlay");
        const settingsSidebar = document.getElementById("settingsSidebar");

        settingsBtn.addEventListener("click", () => {
          settingsSidebar.classList.add("open");
          settingsOverlay.classList.add("open");
        });

        settingsOverlay.addEventListener("click", closeSettings);

        document
          .getElementById("baseFontSlider")
          .addEventListener("input", function () {
            document.getElementById("baseFontValue").textContent = this.value;
          });

        document
          .getElementById("buttonSizeSlider")
          .addEventListener("input", function () {
            document.getElementById("buttonSizeValue").textContent = this.value;
          });

        document.querySelectorAll(".theme-option").forEach((option) => {
          option.addEventListener("click", function () {
            document
              .querySelectorAll(".theme-option")
              .forEach((opt) => opt.classList.remove("selected"));
            this.classList.add("selected");
          });
        });

        document.querySelectorAll(".lang-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const lang = this.getAttribute("data-lang");
            setLanguage(lang);
          });
        });

        document
          .getElementById("saveSettingsBtn")
          .addEventListener("click", saveSettings);

        document
          .getElementById("subDishesToggle")
          .addEventListener("change", function () {
            subDishesEnabled = this.checked;
          });
      }

      function closeSettings() {
        document.getElementById("settingsSidebar").classList.remove("open");
        document.getElementById("settingsOverlay").classList.remove("open");
      }

      // ==================== UI: BOOK PAGES ====================
      function showBookContainer() {
        const bookContainer = document.getElementById("bookContainer");
        bookContainer.style.display = "flex";
        bookContainer.classList.remove("hidden");
      }

      function hideBookContainer() {
        const bookContainer = document.getElementById("bookContainer");
        bookContainer.classList.add("hidden");
        setTimeout(() => {
          bookContainer.style.display = "none";
        }, 800);
      }

      function showMain() {
        const mainContent = document.getElementById("mainContent");
        mainContent.style.display = "block";
        mainContent.classList.add("visible");
      }

      function hideMain() {
        const mainContent = document.getElementById("mainContent");
        mainContent.classList.remove("visible");
        mainContent.style.display = "none";
      }

      function showPageLoader() {
        document.getElementById("pageLoader").style.display = "flex";
        document.getElementById("pageAuth").style.display = "none";
      }

      function showPageAuth() {
        document.getElementById("pageLoader").style.display = "none";
        document.getElementById("pageAuth").style.display = "flex";
      }

      function goToBookAuthScreen() {
        // показать книгу
        showBookContainer();
        // открыть книгу
        document.getElementById("book").classList.add("open");

        // показать страницу формы
        showPageAuth();

        // скрыть main
        hideMain();

        // кнопку "войти" можно скрыть/показать — я оставлю показ
        document.getElementById("authButton").style.display = "none";
        document.getElementById("addCategoryBtn").style.display = "none";
      }

      // ==================== АНИМАЦИЯ КНИГИ ====================
      function initializeApp() {
        loadSettings();

        // Через 1 секунду начинаем анимацию книги
        setTimeout(() => {
          updateBookText("Готуємося...");
          setTimeout(() => {
            openBook();
          }, 1000);
        }, 1000);
      }

      function updateBookText(text) {
        const loadingText = document.getElementById("loadingText");
        if (loadingText) {
          loadingText.textContent = text;
        }
      }

      function updateBookSubtext(text) {
        const subtext = document.getElementById("loadingSubtext");
        if (subtext) {
          subtext.textContent = text;
        }
      }

      function openBook() {
        const book = document.getElementById("book");
        const bookContainer = document.getElementById("bookContainer");

        // Анимация открытия книги
        book.classList.add("open");
        updateBookText("Відкриваємо книгу...");

        // После анимации проверяем пользователя
        setTimeout(() => {
          checkAuthState();
        }, 1500);
      }

      function checkAuthState() {
        updateBookText("Перевірка користувача...");
        showPageLoader();

        // ВАЖНО: подписка должна быть только один раз
        auth.onAuthStateChanged((user) => {
          if (user) {
            currentUser = user;
            localStorage.setItem("cookingBook_user", user.uid);

            // UI: кнопки
            document.getElementById("authButton").style.display = "flex";
            document.getElementById("authText").textContent =
              translations[currentLanguage].logoutText;

            updateBookText("Завантаження ваших рецептів...");
            updateBookSubtext("Це може зайняти кілька секунд...");

            // показать main после загрузки
            loadUserData();
          } else {
            // НЕТ пользователя: показываем книгу + страницу AUTH
            currentUser = null;
            localStorage.removeItem("cookingBook_user");

            updateBookText("Ласкаво просимо!");
            updateBookSubtext("Увійдіть або зареєструйтесь...");

            // через 700мс переключаемся на страницу формы
            setTimeout(() => {
              goToBookAuthScreen();
            }, 700);
          }
        });
      }

      function loadUserData() {
        if (!currentUser) return;

        db.ref(`users/${currentUser.uid}/categories`)
          .once("value")
          .then((snap) => {
            const data = snap.val() || {};

            setTimeout(() => {
              if (Object.keys(data).length === 0) {
                updateBookText("Створюємо ваш перший рецепт...");
                createSampleCategories();
              } else {
                updateBookText("Завершення завантаження...");
                updateBookSubtext("Майже готово...");
                rebuildSearchCache(data);
                renderCategories(data);

                setTimeout(() => {
                  showMainContent();
                }, 1000);
              }
            }, 1500);
          })
          .catch((error) => {
            console.error("Ошибка загрузки данных:", error);
            updateBookText("Помилка завантаження");
            updateBookSubtext("Спробуйте ще раз...");

            setTimeout(() => {
              showMainContent();
              showAuthMenu();
            }, 2000);
          });
      }

      function createSampleCategories() {
        if (!currentUser) return;

        const sampleCategories = {
          sample1: {
            name: "Салати",
            dishes: {
              dish1: {
                name: "Грецький салат",
                description:
                  "Класичний грецький салат з сиром фета, оливками та свіжими овочами.",
                favorite: false,
              },
            },
          },
          sample2: {
            name: "Супи",
            dishes: {
              dish1: {
                name: "Борщ",
                description:
                  "Традиційний український борщ з буряком та капустою.",
                favorite: true,
              },
            },
          },
        };

        db.ref(`users/${currentUser.uid}/categories`)
          .set(sampleCategories)
          .then(() => {
            updateBookText("Завершення налаштування...");
            updateBookSubtext("Майже готово...");
            rebuildSearchCache(sampleCategories);
            renderCategories(sampleCategories);

            setTimeout(() => {
              showMainContent();
            }, 1000);
          });
      }

      function showMainContent() {
        hideBookContainer();
        showMain();

        // кнопки для авторизованного
        document.getElementById("authButton").style.display = "flex";
        document.getElementById("addCategoryBtn").style.display = "flex";
      }

      function showAuthMenu() {
        // Показываем кнопку входа
        document.getElementById("authButton").style.display = "flex";

        // Показываем форму входа
        setTimeout(() => {
          toggleAuthMenu();
        }, 500);
      }

      // ==================== АУТЕНТИФИКАЦИЯ ====================
      function toggleAuthMenu() {
        if (currentUser) {
          if (confirm(translations[currentLanguage].logoutText + "?")) {
            logout();
          }
        } else {
          // если не залогинен — просто вернуть на книгу/форму
          goToBookAuthScreen();
        }
      }

      function showLoginForm() {
        document.getElementById("login-form").style.display = "block";
        document.getElementById("register-form").style.display = "none";
        document.getElementById("login-error").textContent = "";
      }

      function showRegisterForm() {
        document.getElementById("login-form").style.display = "none";
        document.getElementById("register-form").style.display = "block";
        document.getElementById("register-error").textContent = "";
      }

      function hideAuthMenu() {
        document.getElementById("auth-menu").style.display = "none";
      }

      function login() {
        const email = document.getElementById("login-email").value;
        const password = document.getElementById("login-password").value;
        const error = document.getElementById("login-error");

        auth.signInWithEmailAndPassword(email, password).catch((err) => {
          error.textContent = err.message;
        });
      }

      function register() {
        const name = document.getElementById("register-name").value.trim();
        const email = document.getElementById("register-email").value;
        const password = document.getElementById("register-password").value;
        const confirm = document.getElementById(
          "register-confirm-password",
        ).value;
        const error = document.getElementById("register-error");

        if (password !== confirm) {
          error.textContent = translations[currentLanguage].passwordsNotMatch;
          return;
        }

        auth
          .createUserWithEmailAndPassword(email, password)
          .then((cred) => {
            return db
              .ref(`users/${cred.user.uid}/profile`)
              .set({ name, email });
          })
          .then(() => {
            hideAuthMenu();
          })
          .catch((err) => {
            error.textContent = err.message;
          });
      }

      function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth
          .signInWithPopup(provider)
          .then(() => {
            hideAuthMenu();
          })
          .catch((error) => {
            document.getElementById("login-error").textContent = error.message;
          });
      }

      function logout() {
        auth.signOut().then(() => {
          // очистка UI/данных
          document.getElementById("categories").innerHTML = "";
          currentUser = null;
          localStorage.removeItem("cookingBook_user");

          // вернуть на книгу с формой
          goToBookAuthScreen();
        });
      }

      // ==================== ОСНОВНЫЕ ФУНКЦИИ ====================
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text || "";
        return div.innerHTML;
      }

      function showScreen(id) {
        const screens = ["screen-main", "screen-add", "screen-recipe"];
        screens.forEach((screenId) => {
          const el = document.getElementById(screenId);
          if (el) {
            el.style.display = screenId === id ? "block" : "none";
            if (el.classList) {
              if (screenId === id) {
                el.classList.add("is-active");
              } else {
                el.classList.remove("is-active");
              }
            }
          }
        });
      }

      function showNotification(message) {
        const notification = document.createElement("div");
        notification.className = "notification";
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
          notification.style.animation = "slideOut 0.3s ease";
          setTimeout(() => {
            if (notification.parentNode) {
              document.body.removeChild(notification);
            }
          }, 300);
        }, 3000);
      }

      // ==================== КАТЕГОРИИ ====================
      function loadCategories() {
        if (!currentUser) {
          document.getElementById("empty-categories").style.display = "block";
          document.getElementById("addCategoryBtn").style.display = "none";
          return;
        }

        document.getElementById("addCategoryBtn").style.display = "flex";

        db.ref(`users/${currentUser.uid}/categories`)
          .once("value")
          .then((snap) => {
  const data = snap.val() || {};
  rebuildSearchCache(data);
  renderCategories(data);
});
      }

      function rebuildSearchCache(data) {
        searchCache.categories = data || {};
        searchCache.flatCats = [];
        searchCache.flatDishes = [];

        for (const [catId, cat] of Object.entries(searchCache.categories)) {
          const catName = cat?.name || "";
          const dishesObj = cat?.dishes || {};
          const dishEntries = Object.entries(dishesObj);

          const sortedDishes = dishEntries.sort((a, b) => {
            const aFavorite = !!a[1]?.favorite;
            const bFavorite = !!b[1]?.favorite;
            if (aFavorite && !bFavorite) return -1;
            if (!aFavorite && bFavorite) return 1;
            return 0;
          });

          searchCache.flatCats.push({
            catId,
            name: catName,
            dishesCount: dishEntries.length,
            hasFavorites: sortedDishes.some(([_, dish]) => dish?.favorite),
          });

          for (const [dishId, dish] of sortedDishes) {
            searchCache.flatDishes.push({
              catId,
              catName,
              dishId,
              name: dish?.name || "",
              description: dish?.description || "",
              favorite: !!dish?.favorite,
              videoUrl: dish?.videoUrl || "",
            });
          }
        }

        searchCache.flatCats.sort((a, b) => {
          if (a.hasFavorites && !b.hasFavorites) return -1;
          if (!a.hasFavorites && b.hasFavorites) return 1;
          return a.name.localeCompare(b.name);
        });
      }

      function renderCategories(categories) {
        const container = document.getElementById("categories");
        const emptyEl = document.getElementById("empty-categories");

        const frag = document.createDocumentFragment();

        const entries = Object.entries(categories || {});
        if (entries.length === 0) {
          container.innerHTML = "";
          emptyEl.style.display = "block";
          return;
        }
        emptyEl.style.display = "none";

        const t = translations[currentLanguage];

        const sortedCategories = entries.sort((a, b) => {
          const aDishes = a[1]?.dishes || {};
          const bDishes = b[1]?.dishes || {};
          const aHasFavorites = Object.values(aDishes).some(
            (dish) => dish?.favorite,
          );
          const bHasFavorites = Object.values(bDishes).some(
            (dish) => dish?.favorite,
          );
          if (aHasFavorites && !bHasFavorites) return -1;
          if (!aHasFavorites && bHasFavorites) return 1;
          return (a[1]?.name || "").localeCompare(b[1]?.name || "");
        });

        for (const [catId, cat] of sortedCategories) {
          const safeName = cat?.name || "(без назви)";
          const dishes = cat?.dishes || {};
          const dishCount = Object.keys(dishes).length;

          const categoryEl = document.createElement("article");
          categoryEl.className = "card category";
          categoryEl.dataset.catId = catId;

          categoryEl.innerHTML = `
            <div class="category__head">
              <button class="category__toggle" type="button" onclick="toggleDishes('${catId}')">
                ${escapeHtml(safeName)}
                <span class="category__meta">• ${dishCount}</span>
              </button>
              <div class="category__actions">
                <button class="icon-btn" type="button" title="${t.editText}" onclick="editCategory('${catId}')">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="icon-btn" type="button" title="${t.deleteText}" onclick="deleteCategory('${catId}')">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <div class="category__body">
              <div class="add-dish-btn-container" id="add-dish-btn-${catId}">
                <button class="btn-long" type="button" onclick="addDish('${catId}')">
                  <i class="fas fa-plus"></i>
                  <span>${t.addConfirmText} страву</span>
                </button>
              </div>
              <div class="dishes" id="dishes-${catId}" style="display:none;"></div>
            </div>
          `;

          frag.appendChild(categoryEl);
        }

        container.innerHTML = "";
        container.appendChild(frag);
      }

      function toggleDishes(catId) {
        const container = document.getElementById(`dishes-${catId}`);
        const addBtnContainer = document.getElementById(
          `add-dish-btn-${catId}`,
        );

        if (container.style.display === "block") {
          container.style.display = "none";
          addBtnContainer.classList.remove("visible");
          container.innerHTML = "";
        } else {
          addBtnContainer.classList.add("visible");

          if (container.innerHTML === "") {
            loadDishes(catId);
          }
          container.style.display = "block";
        }
      }

      function showAddMenu() {
        if (!currentUser) {
          alert(translations[currentLanguage].noAccountAlert);
          return;
        }
        document.getElementById("new-category-name").value = "";
        showScreen("screen-add");
      }

      function addNewCategory() {
        const name = document.getElementById("new-category-name").value.trim();
        if (!name) {
          alert(translations[currentLanguage].enterCategoryName);
          return;
        }

        const catId = db.ref().push().key;
        db.ref(`users/${currentUser.uid}/categories/${catId}`)
          .set({
            name: name,
            dishes: {},
          })
          .then(() => {
            showScreen("screen-main");
            setTimeout(() => loadCategories(), 0);
          });
      }

      // ==================== НАВИГАЦИЯ ====================
      function goBackFromAdd() {
        showScreen("screen-main");
      }

      function goBackFromRecipe() {
        currentCat = null;
        currentDish = null;
        currentSubdish = null;
        setTopControlsVisible(true);
        showScreen("screen-main");
      }

      // ==================== ИНИЦИАЛИЗАЦИЯ ====================
      document.addEventListener("DOMContentLoaded", () => {
        initializeApp();
        initSettings();

        // Навигация
        document
          .getElementById("backFromAddBtn")
          .addEventListener("click", goBackFromAdd);
        document
          .getElementById("backFromRecipeBtn")
          .addEventListener("click", goBackFromRecipe);

        // Аутентификация
        document
          .getElementById("authButton")
          .addEventListener("click", toggleAuthMenu);
        document
          .getElementById("addCategoryBtn")
          .addEventListener("click", showAddMenu);
        document
          .getElementById("addCategoryConfirmBtn")
          .addEventListener("click", addNewCategory);

        // Формы авторизации
        document.getElementById("loginBtn").addEventListener("click", login);
        document
          .getElementById("registerBtn")
          .addEventListener("click", register);
        document
          .getElementById("googleLoginBtn")
          .addEventListener("click", loginWithGoogle);
        document
          .getElementById("registerSwitchText")
          .addEventListener("click", showRegisterForm);
        document
          .getElementById("loginSwitchText")
          .addEventListener("click", showLoginForm);

          // Пошук
document.getElementById("searchBar").addEventListener("input", runSearch);
document.getElementById("clearSearchBtn").addEventListener("click", clearSearch);

        // Закрытие формы авторизации по клику вне ее
        document
          .getElementById("auth-menu")
          .addEventListener("click", function (e) {
            if (e.target === this) {
              hideAuthMenu();
            }
          });

        // Инициализируем глобальные функции
        window.showScreen = showScreen;
        window.toggleDishes = toggleDishes;
        window.goBackFromAdd = goBackFromAdd;
        window.goBackFromRecipe = goBackFromRecipe;
        window.editCategory = editCategory;
        window.deleteCategory = deleteCategory;
        window.addDish = addDish;
        window.editDish = editDish;
        window.deleteDish = deleteDish;
        window.toggleFavorite = toggleFavorite;
        window.openDish = openDish;
        window.startEdit = startEdit;
        window.saveRecipe = saveRecipe;
        window.cancelEdit = cancelEdit;
        window.addVideo = addVideo;

        // ===== AUTH on BOOK PAGE =====
        document
          .getElementById("loginBtnBook")
          .addEventListener("click", () => {
            const email = document.getElementById("login-email-book").value;
            const password = document.getElementById(
              "login-password-book",
            ).value;
            const err = document.getElementById("login-error-book");
            err.textContent = "";

            auth.signInWithEmailAndPassword(email, password).catch((e) => {
              err.textContent = e.message;
            });
          });

        document
          .getElementById("registerBtnBook")
          .addEventListener("click", () => {
            const name = document
              .getElementById("register-name-book")
              .value.trim();
            const email = document.getElementById("register-email-book").value;
            const pass = document.getElementById(
              "register-password-book",
            ).value;
            const conf = document.getElementById(
              "register-confirm-password-book",
            ).value;
            const err = document.getElementById("register-error-book");
            err.textContent = "";

            if (pass !== conf) {
              err.textContent = translations[currentLanguage].passwordsNotMatch;
              return;
            }

            auth
              .createUserWithEmailAndPassword(email, pass)
              .then((cred) =>
                db.ref(`users/${cred.user.uid}/profile`).set({ name, email }),
              )
              .catch((e) => (err.textContent = e.message));
          });

        document
          .getElementById("googleLoginBtnBook")
          .addEventListener("click", () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch((e) => {
              document.getElementById("login-error-book").textContent =
                e.message;
            });
          });

        // Switch forms on book page
        document
          .getElementById("registerSwitchTextBook")
          .addEventListener("click", () => {
            document.getElementById("login-form-book").style.display = "none";
            document.getElementById("register-form-book").style.display =
              "block";
          });

        document
          .getElementById("loginSwitchTextBook")
          .addEventListener("click", () => {
            document.getElementById("login-form-book").style.display = "block";
            document.getElementById("register-form-book").style.display =
              "none";
          });
      });

      function setTopControlsVisible(visible) {
  const addBtn = document.getElementById("addCategoryBtn");
  const searchWrap = document.getElementById("searchWrap");
  if (addBtn) addBtn.style.display = visible ? "flex" : "none";
  if (searchWrap) searchWrap.style.display = visible ? "block" : "none";
}

      // ====== ОПРЕДЕЛЕНИЕ ОСТАЛЬНЫХ ФУНКЦИЙ ======
      function editCategory(catId) {
        if (!currentUser) return;

        db.ref(`users/${currentUser.uid}/categories/${catId}/name`)
          .once("value")
          .then((snap) => {
            const oldName = snap.val() || "";
            const newName = prompt("Нова назва категорії:", oldName);
            if (newName && newName.trim() !== "" && newName !== oldName) {
              db.ref(`users/${currentUser.uid}/categories/${catId}/name`)
                .set(newName.trim())
                .then(() => {
                  if (searchCache.categories[catId]) {
                    searchCache.categories[catId].name = newName.trim();
                    rebuildSearchCache(searchCache.categories);
                  }
                  loadCategories();
                });
            }
          });
      }

      function deleteCategory(catId) {
        if (
          !currentUser ||
          !confirm(translations[currentLanguage].confirmDeleteCategory)
        )
          return;

        db.ref(`users/${currentUser.uid}/categories/${catId}`)
          .remove()
          .then(() => {
            delete searchCache.categories[catId];
            rebuildSearchCache(searchCache.categories);
            loadCategories();
          });
      }

      function loadDishes(catId) {
        if (!currentUser) return;

        db.ref(`users/${currentUser.uid}/categories/${catId}/dishes`)
          .once("value")
          .then((snap) => {
            const dishes = snap.val() || {};
            const sortedDishes = Object.entries(dishes).sort((a, b) => {
              const aFavorite = !!a[1]?.favorite;
              const bFavorite = !!b[1]?.favorite;
              if (aFavorite && !bFavorite) return -1;
              if (!aFavorite && bFavorite) return 1;
              return 0;
            });
            renderDishes(catId, sortedDishes);
          });
      }

      function renderDishes(catId, dishes) {
        const container = document.getElementById(`dishes-${catId}`);

        container.innerHTML = "";

        const t = translations[currentLanguage];

        for (const [dishId, dish] of dishes) {
          const dishEl = document.createElement("div");
          dishEl.className = "dish";
          dishEl.dataset.dishId = dishId;

          const hasVideo = dish.videoUrl ? "• Є відео" : "";
          const isFavorite = dish.favorite
  ? '<span class="tag star" style="padding:0.2rem 0.45rem;"><i class="fas fa-star"></i></span>'
  : "";

          dishEl.innerHTML = `
            <div class="dish" data-cat="${catId}" data-dish="${dishId}">
  <button class="dish__fav" type="button"
    title="${dish.favorite ? 'Прибрати з улюблених' : 'Додати в улюблені'}"
    onclick="toggleFavorite('${catId}', '${dishId}')">
    ${dish.favorite ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>'}
  </button>

  <div class="dish__main">
    <p class="dish__title" onclick="openDish('${catId}', '${dishId}')">
      ${dish.name}
    </p>
  </div>

  <div class="dish__actions">
    <button class="icon-mini" type="button" title="${t.editText}"
      onclick="editDish('${catId}', '${dishId}')">
      <i class="fas fa-edit"></i>
    </button>

    <button class="icon-mini" type="button" title="${t.deleteText}"
      onclick="deleteDish('${catId}', '${dishId}')">
      <i class="fas fa-trash"></i>
    </button>
  </div>
</div>

          `;

          container.appendChild(dishEl);
        }
      }

      function addDish(catId) {
        if (!currentUser) {
          alert(translations[currentLanguage].noAccountAlert);
          return;
        }

        const name = prompt(translations[currentLanguage].enterDishName);
        if (!name || !name.trim()) return;

        const dishId = db.ref().push().key;
        const dishData = {
          name: name.trim(),
          description: "",
          favorite: false,
          videoUrl: "",
        };

        db.ref(`users/${currentUser.uid}/categories/${catId}/dishes/${dishId}`)
          .set(dishData)
          .then(() => {
            if (!searchCache.categories[catId]) {
              searchCache.categories[catId] = {
                name: searchCache.categories[catId]?.name || "",
                dishes: {},
              };
            }
            searchCache.categories[catId].dishes[dishId] = dishData;
            rebuildSearchCache(searchCache.categories);

            loadDishes(catId);
            loadCategories();
          });
      }

      function editDish(catId, dishId) {
        if (!currentUser) return;

        db.ref(
          `users/${currentUser.uid}/categories/${catId}/dishes/${dishId}/name`,
        )
          .once("value")
          .then((snap) => {
            const oldName = snap.val() || "";
            const newName = prompt("Введіть нову назву страви:", oldName);
            if (newName && newName.trim() !== "" && newName !== oldName) {
              db.ref(
                `users/${currentUser.uid}/categories/${catId}/dishes/${dishId}/name`,
              )
                .set(newName.trim())
                .then(() => {
                  if (searchCache.categories[catId]?.dishes?.[dishId]) {
                    searchCache.categories[catId].dishes[dishId].name =
                      newName.trim();
                    rebuildSearchCache(searchCache.categories);
                  }
                  loadDishes(catId);
                });
            }
          });
      }

      function deleteDish(catId, dishId) {
        if (
          !currentUser ||
          !confirm(translations[currentLanguage].confirmDeleteDish)
        )
          return;

        db.ref(`users/${currentUser.uid}/categories/${catId}/dishes/${dishId}`)
          .remove()
          .then(() => {
            if (searchCache.categories[catId]?.dishes?.[dishId]) {
              delete searchCache.categories[catId].dishes[dishId];
              rebuildSearchCache(searchCache.categories);
            }
            loadDishes(catId);
          });
      }

      function toggleFavorite(catId, dishId) {
        if (!currentUser) {
          alert(translations[currentLanguage].noAccountAlert);
          return;
        }

        const ref = db.ref(
          `users/${currentUser.uid}/categories/${catId}/dishes/${dishId}/favorite`,
        );
        ref
          .once("value")
          .then((snap) => {
            const current = !!snap.val();
            return ref.set(!current);
          })
          .then(() => {
            if (searchCache.categories[catId]?.dishes?.[dishId]) {
              searchCache.categories[catId].dishes[dishId].favorite =
                !searchCache.categories[catId].dishes[dishId].favorite;
              rebuildSearchCache(searchCache.categories);
            }

            loadDishes(catId);
            loadCategories();
          });
      }

      function openDish(catId, dishId) {
        currentCat = catId;
        currentDish = dishId;
        currentSubdish = null;

        if (!currentUser) return;

        db.ref(`users/${currentUser.uid}/categories/${catId}/dishes/${dishId}`)
          .once("value")
          .then((snap) => {
            const dish = snap.val();
            if (!dish) {
              alert("Страва не знайдена");
              return;
            }

            document.getElementById("recipe-name").textContent = dish.name;
            document.getElementById("recipe-display").textContent =
              dish.description || "";
            document.getElementById("recipe-display").contentEditable = "false";
            document
              .getElementById("recipe-display")
              .classList.remove("edit-mode");

            const catName = searchCache.categories[catId]?.name || "Невідома";
            document.getElementById("recipe-category-tag").innerHTML =
              `<i class="fas fa-folder"></i> <span>${translations[currentLanguage].categoryText}${catName}</span>`;

            const favoriteTag = document.getElementById("favorite-tag");
            favoriteTag.style.display = dish.favorite ? "flex" : "none";

            document.getElementById("editRecipeBtn").style.display = "block";
            document.getElementById("recipe-tools").style.display = "none";

            // Загружаем видео если есть
            if (dish.videoUrl) {
              document.getElementById("video-block").style.display = "block";
              document.getElementById("video-url").href = dish.videoUrl;
              document.getElementById("video-url").textContent = dish.videoUrl;
              document.getElementById("video-link").style.display = "flex";
            } else {
              document.getElementById("video-block").style.display = "none";
            }

            document.getElementById("social-links-block").style.display =
              "none";

            document.getElementById("saveRecipeBtn").onclick = saveRecipe;

            setTopControlsVisible(false);

            showScreen("screen-recipe");
          })
          .catch((error) => {
            console.error("Помилка завантаження рецепту:", error);
            alert("Не вдалося завантажити рецепт");
          });
      }

      function startEdit() {
        const display = document.getElementById("recipe-display");
        display.contentEditable = "true";
        display.classList.add("edit-mode");
        display.focus();

        document.getElementById("editRecipeBtn").style.display = "none";
        document.getElementById("recipe-tools").style.display = "flex";
      }

      function saveRecipe() {
        if (!currentCat || !currentDish || !currentUser) return;

        const description = document
          .getElementById("recipe-display")
          .innerText.trim();

        db.ref(
          `users/${currentUser.uid}/categories/${currentCat}/dishes/${currentDish}/description`,
        )
          .set(description)
          .then(() => {
            if (searchCache.categories[currentCat]?.dishes?.[currentDish]) {
              searchCache.categories[currentCat].dishes[
                currentDish
              ].description = description;
            }
            cancelEdit();
          });
      }

      function cancelEdit() {
        const display = document.getElementById("recipe-display");
        display.contentEditable = "false";
        display.classList.remove("edit-mode");

        document.getElementById("editRecipeBtn").style.display = "block";
        document.getElementById("recipe-tools").style.display = "none";

        // Восстанавливаем текст
        db.ref(
          `users/${currentUser.uid}/categories/${currentCat}/dishes/${currentDish}/description`,
        )
          .once("value")
          .then((snap) => {
            display.textContent = snap.val() || "";
          });
      }

      function addVideo() {
        if (!currentCat || !currentDish || !currentUser) return;

        const url = prompt(translations[currentLanguage].enterVideoUrl, "");
        if (!url || url.trim() === "") return;

        const cleanUrl = url.trim();
        db.ref(
          `users/${currentUser.uid}/categories/${currentCat}/dishes/${currentDish}/videoUrl`,
        )
          .set(cleanUrl)
          .then(() => {
            document.getElementById("video-block").style.display = "block";
            document.getElementById("video-url").href = cleanUrl;
            document.getElementById("video-url").textContent = cleanUrl;
            document.getElementById("video-link").style.display = "flex";

            if (searchCache.categories[currentCat]?.dishes?.[currentDish]) {
              searchCache.categories[currentCat].dishes[currentDish].videoUrl =
                cleanUrl;
            }
          });
      }

      // Заглушки для функций, которые не были реализованы
      window.loadSubdishes = function () {};
      window.addSubdish = function () {};
      window.editSubdish = function () {};
      window.deleteSubdish = function () {};
      window.openSubdish = function () {};
      window.saveSubdishRecipe = function () {};
      window.loadSocialLinks = function () {};

      // ==================== ПОШУК ====================
function normalize(s) {
  return (s || "")
    .toString()
    .trim()
    .toLowerCase()
    .replace(/\s+/g, " ");
}

function setSearchUIActive(active) {
  const resultsEl = document.getElementById("search-results");
  const catsWrap = document.getElementById("categories");
  const emptyEl = document.getElementById("empty-categories");

  if (active) {
    resultsEl.style.display = "grid";
    catsWrap.style.display = "none";
    if (emptyEl) emptyEl.style.display = "none";
  } else {
    resultsEl.style.display = "none";
    catsWrap.style.display = "block";
    // пустий стан покаже renderCategories()
  }
}

function renderSearchResults(items) {
  const resultsEl = document.getElementById("search-results");
  resultsEl.innerHTML = "";

  if (!items.length) {
    resultsEl.innerHTML = `<div class="empty"><i class="fas fa-search"></i> Нічого не знайдено</div>`;
    return;
  }

  const t = translations[currentLanguage];

  items.slice(0, 40).forEach((it) => {
    const card = document.createElement("div");
    card.className = "result";

    if (it.type === "dish") {
      const star = it.favorite ? `<i class="fas fa-star" style="color:#f59e0b;"></i>` : "";
      card.innerHTML = `
        <div class="result__top">
          <div>
            <h3 class="result__title">${star} ${escapeHtml(it.name)}</h3>
            <p class="result__desc">${escapeHtml(t.categoryText + (it.catName || ""))}</p>
          </div>
          <span class="result__type">Страва</span>
        </div>
        <div class="result__actions">
          <button class="btn-outline" type="button" onclick="openDish('${it.catId}','${it.dishId}')">
            Відкрити
          </button>
        </div>
      `;
    } else {
      card.innerHTML = `
        <div class="result__top">
          <div>
            <h3 class="result__title">${escapeHtml(it.name)}</h3>
            <p class="result__desc">Страв: ${it.dishesCount}</p>
          </div>
          <span class="result__type">Категорія</span>
        </div>
        <div class="result__actions">
          <button class="btn-outline" type="button" onclick="toggleDishes('${it.catId}')">
            Відкрити
          </button>
        </div>
      `;
    }

    resultsEl.appendChild(card);
  });
}

function runSearch() {
  const input = document.getElementById("searchBar");
  const q = normalize(input.value);

  if (!q) {
    setSearchUIActive(false);
    return;
  }

  const results = [];

  // categories
  for (const c of searchCache.flatCats) {
    if (normalize(c.name).includes(q)) {
      results.push({ type: "cat", ...c });
    }
  }

  // dishes
  for (const d of searchCache.flatDishes) {
    const hay = normalize(d.name + " " + d.description + " " + d.catName);
    if (hay.includes(q)) {
      results.push({ type: "dish", ...d });
    }
  }

  setSearchUIActive(true);
  renderSearchResults(results);
}

function clearSearch() {
  const input = document.getElementById("searchBar");
  input.value = "";
  setSearchUIActive(false);
}

    </script>
  </body>
</html>
